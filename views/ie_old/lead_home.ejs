<!DOCTYPE html>
<html>
<title>Lead with humility</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> -->
<link rel="stylesheet" type="text/css" href="CSS/w3.css"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<style>
  body{
  font-family: "Helvetica","Arial",sans-serif;
  font-size: 14px;
  font-weight: 400;
  line-height: 20px;
  background-image: url("/public/imgbook/bodyBG2.jpg");
  background-color: #cccccc;
  background-size: cover; /* Resize the background image to cover the entire container */
}
p.groove{border-style: groove;}
div.groove{border-style: groove; border-radius: 10px;}
.modal {
     /* position: absolute; */
     top: 10px;
     right: 100px;
     bottom: 0;
     left: 0;
     z-index: 10000;
     overflow: auto;
     overflow-y: auto;
  }

</style>

<body>
  <div class="container">
    <nav class="navbar navbar-default navbar-fixed-top" style="background-image: url('/public/imgbook/lead.jpg');">
      <div class="w3-row w3-right" style="padding-top: 15px;">
          <from>
              <label for="idnv"><span class="glyphicon glyphicon-user" style="padding-right: 20px;"></span><span id="name">IDNV</span></label>
              <input id="idnv" name="idnv" type="number">
              <input type="button" class="btn btn-primary w3-red" style="color: whitesmoke;" value="Đăng nhập" id="login_stt" onclick="login()">
          </from>
      </div>
      <a><div class="w3-padding-16 w3-left" onclick="w3_open()">☰ Menu</div></a>
      <div class="w3-row w3-center"  style="padding-bottom: 38px;">
          <h1 style="font-size: 46px; color: cornsilk;">Chào mừng bạn đến với chương trình lead with humility</h1>
          <a href="/lead" id="refresh" style="display: none;"></a>
      </div>
    </nav>
  </div>

<div id="menu" class="w3-sidebar w3-bar-block w3-light-grey w3-card" style="width:240px; margin-top: 180px;">
  <button class="w3-bar-item w3-button tablink" onclick="openCity(event, 'Home')"><span class="glyphicon glyphicon-home" style="padding-right: 20px;"></span>Trang chủ</button>
  <button class="w3-bar-item w3-button tablink" onclick="openCity(event, 'London')"><span class="glyphicon glyphicon glyphicon-list" style="padding-right: 20px;" id="infor"></span>Thông tin nhân viên</button>
  <button class="w3-bar-item w3-button tablink" onclick="openCity(event, 'Paris')"><span class="glyphicon glyphicon glyphicon-gift" style="padding-right: 20px;"></span>đổi quà</button>
  <button class="w3-bar-item w3-button tablink" onclick="openCity(event, 'Tokyo')"><span class="glyphicon 	glyphicon glyphicon-briefcase" style="padding-right: 20px;"></span>Thi trả lời câu hỏi</button>
</div>

<div style="margin-left:240px; margin-top: 180px;">
  <!-- <div class="w3-padding">Vertical Tab Example (sidebar)</div> -->

  <div id="Home" class="w3-container city">
    <h2>Thông tin về chương trình</h2>
    <p>mục tiêu.</p>
    <p>cách thức tham gia.</p>
  </div>

  <div id="London" class="w3-container city" style="display:none">
    <h2>Thông tin tích điểm . Tuần đăng nhập: <span id="week_login">0</span> , lần đăng nhập hiện tại là: <span id="t_login">0</span></h2>
    <p>lịch sử đăng nhập và trả lời câu hỏi.</p>
    <div class="row">    
      <div style=" width: 100%;">
        <div class="row" style="width:100%; margin-left: auto; margin-right: auto;">
          <div class="table-responsive" style="height: 415px; width: 100%; margin-left: auto; margin-right: auto;">
            <table id="table_detail" class="w3-table-all w3-hoverable" style="margin-left: auto; margin-right: auto;">
              <!-- <table id="table_content"> style="height: 310px;" -->
              <thead>
                <tr >
                  <th>MÃ SỐ</th>
                  <th>NGÀY</th>
                  <th>TUẦN</th>
                  <th>LẦN ĐĂNG NHẬP</th>
                  <th>ĐIỂM</th>
                </tr>
              </thead>  
              <tbody style="height: 395px;">
              </tbody>
            </table>
          </div>
          <br>
        </div>
      </div>
    </div> 
  </div>

  <div id="Paris" class="w3-container city" style="display:none">
    <h2>Đổi quà và nhận thưởng</h2>
    <p>hướng dẫn đổi điểm nhận quà:.</p> 
    <p>đổi quà.</p>
  </div>

  <div id="Tokyo" class="w3-container city" style="display:none">
      <div class="row groove" style="padding: 10px; font-size: x-large; background-color: wheat;">
            <div class="row" style="padding-bottom: 15px;">
              <span style=" padding-right: 15px; padding-left: 30px;">Câu hỏi số</span><span id="question_number">0</span><span style="padding-right: 15px;"> / điểm của bạn:</span><span id="score">0</span><span style="padding-left: 15px;" id="guide">.nhấn bắt đầu để trả lời câu hỏi</span>
            </div>            
            <div class="col-md-2 w3-center">
              <input type="button" class="form-control btn btn-primary w3-blue" style=" color: whitesmoke;" value="Bắt đầu" id="start_answer" onclick="start_answer()">
            </div>
      </div>
      <div class="w3-padding" id="div_question" style="display: none; font-size: x-large;">
            <div class="w3-padding">
              <p style="background-color: yellow; border: 2px solid cadetblue; border-radius: 5px; padding: 10px; margin: auto;" id="question">Câu hỏi: bạn hãy chọn 1 trong các câu trả lời bên dưới</p>
            </div>
            <div class="w3-padding">
              <p style="border: 2px solid cadetblue; border-radius: 5px; padding: 10px; margin: auto;" id="answerA">Câu A: câu D đúng</p>
            </div>
            <div class="w3-padding">
              <p style="border: 2px solid cadetblue; border-radius: 5px; padding: 10px; margin: auto;" id="answerB">Câu B: câu A đúng</p>
            </div>
            <div class="w3-padding">
              <p style="border: 2px solid cadetblue; border-radius: 5px; padding: 10px; margin: auto;" id="answerC">Câu C: câu B đúng</p>
            </div>
            <div class="w3-padding">
              <p style="border: 2px solid cadetblue; border-radius: 5px; padding: 10px; margin: auto;" id="answerD">Câu D: tất cả các câu trên đều đúng</p>
            </div>
            <div class="w3-padding">
              <div class="col-md-12 groove" style="padding: 10px; background-color: #10F2AA;">
                <form id="form_answer">
                  <div class="col-md-3">
                    <label class="form-control" style="background-color: #10F2AA;" for="sel_answer">câu trả lời của bạn là:</label>
                  </div>
                  <div class="col-md-2">
                    <select class="form-control" name="sel_answer" id="sel_answer">
                      <option>-</option>
                      <option>Câu A</option>
                      <option>Câu B</option>
                      <option>Câu C</option>
                      <option>Câu D</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <input type="button" class="form-control btn btn-primary w3-red" style=" color: whitesmoke;" value="Trả lời" id="submit_ans" onclick="submit_answer()">
                  </div>
                  <div class="col-md-2">
                    <input type="button" class="form-control btn btn-primary w3-red" disabled="true" style=" color: whitesmoke;" id="next_q" value="câu tiếp >>" onclick="next_question()">
                  </div>
                  <div class="col-md-2" style="display: none;">
                    <input type="text" id="ans" name="ans">
                  </div>
                </form>
              </div>
            </div>
      </div>
  
  </div>

</div>

<!-- ???????????????????????????????????????????????????????????????????????????????????????? -->
<button id="dialog2" style="display: none;" type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Open Modal</button>
<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
  <div class="modal-dialog">
  
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title"><strong>Kết quả trả lời</strong><span id="sys_confirm">.</span></h4>
      </div>
      <div class="modal-body">
        <form id="changeline">
          <label class="form-control w3-center" id="a_confirm">Bạn đã trả lời đúng!</label>
          <label id="a_result">câu trả lời là:</label>
          <br>
        </form>
      </div>
      <div class="modal-footer">
        <button id="close_dialog2" style="display: none;" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
    
  </div>
</div>
<!-- ???????????????????????????????????????????????????????????????????????????????????????? -->




<script type="text/javascript">
function w3_open(){
  document.getElementById("menu").style.display="inline";
}
function w3_close(){
  document.getElementById("menu").style.display="none";
}
function openCity(evt, cityName) {
              var i, x, tablinks;
              x = document.getElementsByClassName("city");
              for (i = 0; i < x.length; i++) {
                x[i].style.display = "none";
              }
              tablinks = document.getElementsByClassName("tablink");
              for (i = 0; i < x.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" w3-red", ""); 
              }
              document.getElementById(cityName).style.display = "block";
              evt.currentTarget.className += " w3-red";
}

function submit_answer(){
  if(document.getElementById("sel_answer").value=="-"){
    alert('Bạn chưa chọn câu trả lời!')
    return;
  }
  document.getElementById("a_confirm").innerText="Bạn đã trả lời sai!"
  if (document.getElementById("sel_answer").value==document.getElementById("ans").value){
    var score=parseInt(document.getElementById("score").innerText)+2
    document.getElementById("score").innerText=score
    document.getElementById("a_confirm").innerText="Bạn đã trả lời đúng!"
  }
  document.getElementById("dialog2").click();
  document.getElementById("next_q").disabled=false;
  document.getElementById("submit_ans").disabled=true;
  document.getElementById("guide").innerText=". nhấn nút tiếp theo để chuyển sang câu tiếp theo!"
  var score=parseInt(document.getElementById("score").innerText)
  var week=document.getElementById("week_login").innerText
  var user=document.getElementById("idnv").value
  var t_log=document.getElementById("t_login").innerText
              event.preventDefault();
              var xhttp = new XMLHttpRequest();
              xhttp.onreadystatechange = function() {
                  if (this.readyState == 4 && this.status == 200) {
                      console.log(this.response)
                      if (this.responseText=="ID không đăng nhập được"){
                        document.getElementById("sys_confirm").innerText=" Chưa được cập nhật _ Lỗi hệ thống"
                      } else{
                        document.getElementById("sys_confirm").innerText=" Đã được cập nhật"
                      }
                  }
                };
                xhttp.open("get", "/lead/submit/"+user+"/"+week+"/"+t_log+"/"+score, true);
                xhttp.send();
}
function next_question(){
    document.getElementById("sel_answer").value="-";
    var nq=parseInt(document.getElementById("question_number").innerText)
    if (nq<5){
      start_answer()
    } else{
      alert("bạn đã hoàn thành trả lời 5 câu hỏi của lượt này!")
      document.getElementById("div_question").style.display="none"
      document.getElementById("start_answer").style.display="none"
      get_detail();
    }
    
}
function login() {
              event.preventDefault();
              var xhttp = new XMLHttpRequest();
              xhttp.onreadystatechange = function() {
                  if (this.readyState == 4 && this.status == 200) {
                      console.log(this.response)
                      if (this.responseText=="ID không đăng nhập được"){
                        alert(this.responseText)
                      } else{
                        var result_login=JSON.parse(this.response);
                        document.getElementById("idnv").disabled = true;
                        // document.getElementById("pass_sign_up").disabled = true;
                        document.getElementById("login_stt").value="Đăng xuất"
                        document.getElementById("name").innerText=result_login[0].name
                        alert("bạn đã đăng nhập thành công")
                        get_detail();
                      }
                      
                  }
                };
                var login_status=document.getElementById("login_stt").value
                var user_sign_up=document.getElementById("idnv").value
                if (login_status=="Đăng nhập"){
                    if (user_sign_up==''){
                    alert('Bạn chưa nhập User');
                    return;
                    }
                    xhttp.open("get", "/lead/login/"+user_sign_up, true);
                    xhttp.send();
                } else{
                  document.getElementById("refresh").click();
                }
};
function start_answer(){
    event.preventDefault();
    var login_status=document.getElementById("login_stt").value
    var user_sign_up=document.getElementById("idnv").value
    if (login_status=="Đăng nhập"){
      alert("Vui lòng đăng nhập để bắt đầu!")
      return;
    }
    if (document.getElementById("t_login").innerText=="6"){
      alert("Bạn đã trả lời quá 5 lần trong tuần!\nVui lòng quay trở lại sau!");
      return;
    }
    document.getElementById("div_question").style.display="grid"
    document.getElementById("start_answer").style.display="none"
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            console.log(this.response)
            if (this.responseText=="error"){
              alert('Hệ thống đang bị lỗi \n Vui lòng quay trở lại sau')
            } else{
              var q=JSON.parse(this.response);
              document.getElementById("question").innerHTML="<b>Câu hỏi: "+q[0].question+"</b>";
              document.getElementById("answerA").innerText="Câu A: "+q[0].answerA;
              document.getElementById("answerB").innerText="Câu B: "+q[0].answerB;
              document.getElementById("answerC").innerText="Câu C: "+q[0].answerC;
              document.getElementById("answerD").innerText="Câu D: "+q[0].answerD;
              document.getElementById("a_result").innerText="Câu trả lời là: "+q[0].answer;
              if (q[0].answerA==q[0].answer){
                document.getElementById("ans").value="Câu A";
              }
              if (q[0].answerB==q[0].answer){
                document.getElementById("ans").value="Câu B";
              }
              if (q[0].answerC==q[0].answer){
                document.getElementById("ans").value="Câu C";
              }
              if (q[0].answerD==q[0].answer){
                document.getElementById("ans").value="Câu D";
              }
              console.log(document.getElementById("ans").value)
              var qu=parseInt(document.getElementById("question_number").innerText)+1
              document.getElementById("question_number").innerText=qu
              document.getElementById("next_q").disabled=true;
              document.getElementById("submit_ans").disabled=false;
              document.getElementById("guide").innerText=". Chọn câu trả lời của bạn và nhấn nút trả lời"
            }  
        }
      };
      xhttp.open("get", "/lead/get_question/"+user_sign_up, true);
      xhttp.send();
};
function get_detail(){
              event.preventDefault();
              get_week();
              var xhttp = new XMLHttpRequest();
              xhttp.onreadystatechange = function() {
                  if (this.readyState == 4 && this.status == 200) {
                      console.log(this.response)
                      if (this.responseText=="ID không đăng nhập được"){
                        alert('ID đăng nhập lần đầu tiên')
                        document.getElementById("t_login").innerText="1"
                      } else{
                        var ds=JSON.parse(this.response);
                        var i;
                        var trHTML_ds='';
                        var dn=0;
                        for (i = 0; i < ds.length; i++) {
                          trHTML_ds += '<tr><td >' + ds[i].user + '</td><td >' + ds[i].date + '</td><td >' + ds[i].week + '</td><td >' + ds[i].login+ '</td><td >' + ds[i].score+'</td></tr>';
                          if (parseInt(ds[i].week)==parseInt(document.getElementById("week_login").innerText)){
                            dn=parseInt(ds[i].login)+1
                          }
                        };
                        $('#table_detail tbody').html(trHTML_ds)
                        if (dn==0) {
                          document.getElementById("t_login").innerText="1"
                        } else {
                          document.getElementById("t_login").innerText=dn
                        }
                        document.getElementById("infor").click();
                      }
                      
                  }
                };
                var login_status=document.getElementById("login_stt").value
                var user_sign_up=document.getElementById("idnv").value
                xhttp.open("get", "/lead/detail/"+user_sign_up, true);
                xhttp.send();
}
function get_week(){
              event.preventDefault();
              var xhttp = new XMLHttpRequest();
              xhttp.onreadystatechange = function() {
                  if (this.readyState == 4 && this.status == 200) {
                      console.log(this.response)
                      if (this.responseText=="ID không đăng nhập được"){
                        alert('ID đăng nhập lần đầu tiên')
                      } else{
                        var ds=JSON.parse(this.response);
                        document.getElementById("week_login").innerText=ds[0].week
                      }
                  }
                };
                xhttp.open("get", "/lead/get_week", true);
                xhttp.send();
}





</script>

</body>
</html>
