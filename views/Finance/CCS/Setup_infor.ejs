<!DOCTYPE html>
<html lang="en" dir="ltr">
    <header>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <!-- <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-purple.min.css"> -->
        <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.purple-indigo.min.css" />
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="/JS/getmdl/getmdl-select.min.css"/>
        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
        <script defer src="/JS/getmdl/getmdl-select.min.js"></script>
        <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script> -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <title>CCS - Information</title>
    </header>
    <body style="background-color: white;">
        <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
            <header class="mdl-layout__header">
                <div class="mdl-layout__header-row">
                    <!-- Title -->
                    <span class="mdl-layout-title">INFORMATION</span>
                    <div class="mdl-layout-spacer"></div>
                      
                </div>
                <!-- Tabs -->
                
            </header>
            <%- include ("partials/navTemplate.ejs"); -%>
            <main class="mdl-layout__content">
                <div class="page-content">
                    <div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect" style="margin: 10px auto;">
                        <div id="tab_list" class="mdl-tabs__tab-bar" style="border: none">
                            <a href="#PRICE_LIST" class="mdl-tabs__tab is-active">PRICE LIST</a>
                            <a href="#VENDOR" class="mdl-tabs__tab">VENDOR</a>
                            <a href="#PIC" class="mdl-tabs__tab" onclick="fnc_pic()">PIC</a>
                        </div>
                        <div class="mdl-tabs__panel is-active" id="PRICE_LIST">
                            <div class="mdl-grid" style="width: 100%;">
                                <div class="mdl-textfield mdl-js-textfield" style="margin: 10px auto;">
                                    <input class="mdl-textfield__input" type="text" id="txt_item_find">
                                    <label class="mdl-textfield__label" for="txt_item_find">Find Item, PR...</label>
                                </div>
                            </div>
                            <div style="background-color: transparent; padding: 0; width: 90%; overflow: auto; margin: 10px auto;">
                                <table class="mdl-data-table mdl-js-data-table" style="border: none; width: 100%; height: 90%; margin: 10px auto;">
                                    <colgroup>
                                        <col span="1" style="width: 10px;">
                                    </colgroup>
                                    <thead style="background-color: orange;">
                                        <tr style=" height: 60px;">
                                            <th style="color: white;">#</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">PR</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">ITEM</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">TIẾNG VIỆT</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">TIẾNG ANH</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;" id="txt_dvt">ĐVT</th>
                                            <div class="mdl-tooltip" data-mdl-for="txt_dvt">Đơn vị tính</div>
                                            <th style="color: white;" id="txt_dg">Đ.G</th>
                                            <div class="mdl-tooltip" data-mdl-for="txt_dg">Đơn giá</div>
                                            <th style="color: white;" id="txt_ck">C.K</th>
                                            <div class="mdl-tooltip" data-mdl-for="txt_ck">Chiết khấu</div>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;" id="txt_tt">T.T</th>
                                            <div class="mdl-tooltip" data-mdl-for="txt_tt">Tiền tệ</div>
                                            <th style="color: white;" id="txt_sl">S.L</th>
                                            <div class="mdl-tooltip" data-mdl-for="txt_sl">Số lượng</div>
                                            <th style="color: white;" id="txt_cp">C.P</th>
                                            <div class="mdl-tooltip" data-mdl-for="txt_cp">Đặt chênh lệch tối đa</div>
                                            <th style="color: white;" id="txt_lt">L.T</th>
                                            <div class="mdl-tooltip" data-mdl-for="txt_lt">Lead time</div>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;" id="txt_gc">G.C</th>
                                            <div class="mdl-tooltip" data-mdl-for="txt_gc">Ghi chú</div>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;" id="txt_hh">H.H</th>
                                            <div class="mdl-tooltip" data-mdl-for="txt_hh">Hết hạn</div>
                                        </tr>
                                    </thead>
                                    <tbody id="table_body_quotation">
                                    </tbody>
                                </table>
                            </div>
                            
                            
                        </div>
                        <div class="mdl-tabs__panel" id="VENDOR">
                            <div class="mdl-grid" style="width: 100%;">
                                <div class="mdl-textfield mdl-js-textfield" style="margin: 10px auto;">
                                    <input class="mdl-textfield__input" type="text" id="txt_vendor_find">
                                    <label class="mdl-textfield__label" for="txt_vendor_find"><i class="material-icons">search</i></label>
                                </div>
                            </div>
                            <table class="mdl-data-table mdl-js-data-table mdl-shadow--6dp" style="border-radius: 10px; border: none; width: 80%; overflow: hidden; margin: 10px auto;">
                                <thead style="background-color: green;">
                                    <tr style=" height: 60px;" style="border-radius: 10px;">
                                        <th style="color: white;">#</th>
                                        <th class="mdl-data-table__cell--non-numeric" style="color: white;">VENDOR_NUM</th>
                                        <th class="mdl-data-table__cell--non-numeric" style="color: white;">VENDOR_LOC</th>
                                        <th class="mdl-data-table__cell--non-numeric" style="color: white;">VENDOR_NAME</th>
                                        <th class="mdl-data-table__cell--non-numeric" style="color: white;">EMAIL</th>
                                        <th class="mdl-data-table__cell--non-numeric" style="color: white;">STATUS</th>
                                        <th class="mdl-data-table__cell--non-numeric" style="color: white;">UPDATE</th>
                                    </tr>
                                </thead>
                                <tbody id="table_body_vendor">
                                </tbody>
                            </table>
                            
                        </div>
                        <div class="mdl-tabs__panel" id="PIC">
                            <table class="mdl-data-table mdl-js-data-table mdl-shadow--6dp" style="border-radius: 10px; border: none; width: 500px; overflow: hidden; margin: 10px auto;">
                                <thead style="background-color: blue;">
                                    <tr style=" height: 60px;" style="border-radius: 10px;">
                                        <th class="mdl-data-table__cell--non-numeric" style="color: white;">#</th>
                                        <th class="mdl-data-table__cell--non-numeric" style="color: white;">CATEGORY</th>
                                        <th class="mdl-data-table__cell--non-numeric" style="color: white;">PURCHASER</th>
                                        <th class="mdl-data-table__cell--non-numeric" style="color: white;">TimeUpdate</th>
                                    </tr>
                                </thead>
                                <tbody id="table_body_purchaser">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        
    </body>
    <script>
        table_body_quotation=document.getElementById('table_body_quotation')
        function load_item_quotation(item=''){
            var xsend= new XMLHttpRequest();
            xsend.open("POST","/CCS/Get_Item_Quotation",true);
            xsend.onreadystatechange= function(){
                if (this.readyState==4 && this.status==200){
                    data=JSON.parse(xsend.responseText);
                    while (table_body_quotation.childNodes.length>0)
                    table_body_quotation.removeChild(table_body_quotation.childNodes[0]);
                    for (var i=0; i<data.length; i++){
                        var tr=document.createElement("tr");
                        //stt
                        var tdSTT=document.createElement("td");
                        var node=document.createTextNode(i+1);
                        tdSTT.appendChild(node);
                        tr.appendChild(tdSTT);
                        //RequestID
                        var tdItem=document.createElement("td");
                        tdItem.setAttribute("class","mdl-data-table__cell--non-numeric");
                        // tdItem.setAttribute("style", "display: none;")
                        var node=document.createTextNode(data[i].RequestID);
                        tdItem.appendChild(node);
                        tr.appendChild(tdItem);
                        sessionStorage.setItem(data[i].ID+'_PR_infor', JSON.stringify(data[i]))
                        //Item
                        var tdUnit=document.createElement("td");
                        tdUnit.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Item);
                        tdUnit.appendChild(node);
                        tr.appendChild(tdUnit);
                        //Vietnamese
                        var tdUnit=document.createElement("td");
                        tdUnit.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Vietnamese.substring(0, 50));
                        tdUnit.appendChild(node);
                        tr.appendChild(tdUnit);
                        //English
                        var tdUnit=document.createElement("td");
                        tdUnit.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].English.substring(0, 50));
                        tdUnit.appendChild(node);
                        tr.appendChild(tdUnit);
                        //Unit
                        var tdQuan=document.createElement("td");
                        tdQuan.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Unit);
                        tdQuan.appendChild(node);
                        tr.appendChild(tdQuan);
                        //Price
                        var tdQuan=document.createElement("td");
                        total=data[i].Price.toLocaleString('en-US', {minimumFractionDigits: 0});
                        var node=document.createTextNode(total);
                        tdQuan.appendChild(node);
                        tr.appendChild(tdQuan);
                        //Discount
                        var tdQuan=document.createElement("td");
                        var node=document.createTextNode(data[i].Discount);
                        if (data[i].Discount==null) node=document.createTextNode(0);
                        tdQuan.appendChild(node);
                        tr.appendChild(tdQuan);
                        //Currency
                        var tdQuan=document.createElement("td");
                        tdQuan.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Currency);
                        tdQuan.appendChild(node);
                        tr.appendChild(tdQuan);
                        //Quantity
                        var tdQuan=document.createElement("td");
                        // tdQuan.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Quantity);
                        tdQuan.appendChild(node);
                        tr.appendChild(tdQuan);
                        //Allowance
                        var tdQuan=document.createElement("td");
                        // tdQuan.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Allowance);
                        if (data[i].Allowance==null) node=document.createTextNode(0);
                        tdQuan.appendChild(node);
                        tr.appendChild(tdQuan);
                        //Leadtime
                        var tdEs=document.createElement("td");
                        // tdEs.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Leadtime);
                        tdEs.appendChild(node);
                        tr.appendChild(tdEs);
                        //Notice
                        var tdEs=document.createElement("td");
                        tdEs.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Notice);
                        if (data[i].Notice==null) node=document.createTextNode("");
                        tdEs.appendChild(node);
                        tr.appendChild(tdEs)
                        //Expired
                        var tdEs=document.createElement("td");
                        tdEs.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var timeUpdate=(new Date(data[i].ExpiredDate)).toLocaleString("en-US", {timeZone: "Asia/Bangkok"}).split(',')[0];
                        var node=document.createTextNode(timeUpdate);
                        tdEs.appendChild(node);
                        tr.appendChild(tdEs)
                        
                        componentHandler.upgradeElement(tr);
                        table_body_quotation.appendChild(tr);
                    }
                }
            }
            xsend.setRequestHeader("Content-type", "application/json");
            data={item: item};
            xsend.send(JSON.stringify(data));
        }
        document.getElementById('txt_item_find').addEventListener('keyup', function(){
            item_find=document.getElementById('txt_item_find').value;
            load_item_quotation(item_find);
        });
        function load_vendor_find(vendor){
            var xsend= new XMLHttpRequest();
            xsend.open("POST","/CCS/Get_Vendors",true);
            xsend.onreadystatechange= function(){
                if (this.readyState==4 && this.status==200){
                    data=JSON.parse(xsend.responseText);
                    while (table_body_vendor.childNodes.length>0)
                    table_body_vendor.removeChild(table_body_vendor.childNodes[0]);
                    for (var i=0; i<data.length; i++){
                        var tr=document.createElement("tr");
                        //stt
                        var tdSTT=document.createElement("td");
                        var node=document.createTextNode(i+1);
                        tdSTT.appendChild(node);
                        tr.appendChild(tdSTT);
                        //VENDOR NUM
                        var tdItem=document.createElement("td");
                        tdItem.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].ID);
                        tdItem.appendChild(node);
                        tr.appendChild(tdItem);
                        sessionStorage.setItem(data[i].ID+'_vendor', JSON.stringify(data[i]))
                        //VENDOR LOC
                        var tdUnit=document.createElement("td");
                        tdUnit.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Location);
                        tdUnit.appendChild(node);
                        tr.appendChild(tdUnit);
                        //VENDOR NAME
                        var tdUnit=document.createElement("td");
                        tdUnit.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Name.substring(0, 50));
                        if (data[i].Name==null) var node=document.createTextNode('')
                        tdUnit.appendChild(node);
                        tr.appendChild(tdUnit);
                        //VENDOR EMAIL
                        var tdUnit=document.createElement("td");
                        tdUnit.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Email);
                        if (data[i].Email==null) var node=document.createTextNode('')
                        tdUnit.appendChild(node);
                        tr.appendChild(tdUnit);
                        //STATUS
                        var tdQuan=document.createElement("td");
                        tdQuan.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Status);
                        tdQuan.appendChild(node);
                        tr.appendChild(tdQuan);
                        //TIME UPDATE
                        var tdQuan=document.createElement("td");
                        tdQuan.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var timeUpdate=(new Date(data[i].TimeUpdate)).toLocaleString("en-US", {timeZone: "Asia/Bangkok"}).split(',')[0];
                        var node=document.createTextNode(timeUpdate);
                        tdQuan.appendChild(node);
                        tr.appendChild(tdQuan);
                        componentHandler.upgradeElement(tr);
                        table_body_vendor.appendChild(tr);
                    }
                }
            }
            xsend.setRequestHeader("Content-type", "application/json");
            data={vendor: vendor};
            xsend.send(JSON.stringify(data));
        }
        document.getElementById('txt_vendor_find').addEventListener('keyup', function(){
            vendor_find=document.getElementById('txt_vendor_find').value;
            load_vendor_find(vendor_find);
        });
        table_body_purchaser=document.getElementById('table_body_purchaser')
        function fnc_pic(){
            var xsend= new XMLHttpRequest();
            xsend.open("POST","/CCS/Get_Purchasers_Category",true);
            xsend.onreadystatechange= function(){
                if (this.readyState==4 && this.status==200){
                    data=JSON.parse(xsend.responseText);
                    while (table_body_purchaser.childNodes.length>0)
                    table_body_purchaser.removeChild(table_body_purchaser.childNodes[0]);
                    for (var i=0; i<data.length; i++){
                        var tr=document.createElement("tr");
                        //stt
                        var tdSTT=document.createElement("td");
                        var node=document.createTextNode(i+1);
                        tdSTT.appendChild(node);
                        tr.appendChild(tdSTT);
                        //VENDOR NUM
                        var tdItem=document.createElement("td");
                        tdItem.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].CATEGORY);
                        tdItem.appendChild(node);
                        tr.appendChild(tdItem);
                        //VENDOR LOC
                        var tdUnit=document.createElement("td");
                        tdUnit.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].PIC);
                        tdUnit.appendChild(node);
                        tr.appendChild(tdUnit);
                        //TIME UPDATE
                        var tdQuan=document.createElement("td");
                        tdQuan.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var timeUpdate=(new Date(data[i].TimeUpdate)).toLocaleString("en-US", {timeZone: "Asia/Bangkok"}).split(',')[0];
                        var node=document.createTextNode(timeUpdate);
                        tdQuan.appendChild(node);
                        tr.appendChild(tdQuan);
                        tr.setAttribute('ondblclick', 'func_purchaser_chage(this)');
                        componentHandler.upgradeElement(tr);
                        table_body_purchaser.appendChild(tr);
                    }
                }
            }
            xsend.setRequestHeader("Content-type", "application/json");
            xsend.send();
        }
        
    </script>