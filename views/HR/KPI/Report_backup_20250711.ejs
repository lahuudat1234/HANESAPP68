<!DOCTYPE html>
<html lang="en" dir="ltr">
    <header id="header_content">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <!-- <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-purple.min.css"> -->
        <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.purple-indigo.min.css" />
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="/JS/getmdl/getmdl-select.min.css"/>
        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
        <script defer src="/JS/getmdl/getmdl-select.min.js"></script>
        <script defer type="text/javascript" src="/JS/chart/Chart.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
        <title>Báo cáo KPI</title>
    </header>
    <body onload="load_dept()">
        <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
            <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title">KẾT QUẢ KPI CÔNG TY HBI</span>
                <div class="mdl-layout-spacer"></div>
                <div id="div_cbb_year" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" 
                    style="width: 100px; margin-left: 10px; margin-right: 20px;">
                    <input type="text" value="" class="mdl-textfield__input" id="cbb_year" readonly>
                    <input type="hidden" value="" name="cbb_year">
                    <label for="cbb_year" class="mdl-textfield__label" style="color:white">Năm...</label>
                    <ul for="cbb_year" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-shadow--8dp" id="list_cbb_year">
                        <li class="mdl-menu__item">2020</li>
                        <li class="mdl-menu__item">2021</li>
                        <li class="mdl-menu__item">2022</li>
                        <li class="mdl-menu__item">2023</li>
                        <li class="mdl-menu__item">2024</li>
                    </ul>
                </div>
                <div id="div_cbb_period" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" 
                    style="width: 400px; margin-left: 10px;">
                    <input type="text" value="" class="mdl-textfield__input" id="cbb_period" readonly>
                    <input type="hidden" value="" name="cbb_period">
                    <label for="cbb_period" class="mdl-textfield__label" style="color:white">Kỳ đánh giá</label>
                    <ul for="cbb_period" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-shadow--8dp" id="list_cbb_period">
                    </ul>
                </div>
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent"  style="margin-left: 20px; background-color: red;" id="btn_update_period">
                    <i class="material-icons">update</i>
                    Update
                </button>
            </div>
            </header>
            <%- include ("../partials/navTemplate.ejs"); -%>
            <main class="mdl-layout__content">
                <div class="page-content">
                    <style>
                        .header-align{
                            /* margin-left: 20px; */
                            margin-top: 10px;
                            padding: 0;
                            margin-bottom: 5px;
                            font-weight: bold;
                            color: rebeccapurple;
                        }
                        .p-align{
                            /* margin-left: 40px; */
                            margin-top: 10px;
                        }
                        .header-sub-align{
                            /* margin-left: 40px; */
                            margin-top: 10px;
                            padding: 0;
                            /* margin-top: 5px; */
                            margin-bottom: 5px;
                            color: red;
                            font-weight: bold;
                        }
                        .solid{
                            border-style: solid;
                        }
                    </style>
                    
                    <div class="mdl-grid" style="width: 99%; margin: 10px auto;">
                        <div class="mdl-cell mdl-cell--2-col mdl-shadow--6dp" style="background-color: white;">
                            <div class="mdl-card" style=" width: 100%;">
                                <div class="mdl-card__title" style="background: orangered; color: white;">
                                    <h2 class="mdl-card__title-text" style="margin:0 auto;">ĐIỀU KIỆN LỌC</h2>
                                </div>
                                <div class="mdl-card__supporting-text">
                                    <div>Bộ Phận:</div>
                                    <div id="div_cbb_dept" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" 
                                        style="width: 80%; margin-left: 10px;">
                                        <input type="text" value="" class="mdl-textfield__input" id="cbb_dept" readonly style="color: black;">
                                        <input type="hidden" value="" name="cbb_dept" style="color: black;">
                                        <label for="cbb_dept" class="mdl-textfield__label">BỘ PHẬN</label>
                                        <ul for="cbb_dept" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-shadow--8dp" id="list_cbb_cbb_dept" style="color: black;">
                                            <li class="mdl-menu__item" data-val="All">All</li>
                                            <li class="mdl-menu__item" data-val="Administration">Administration</li>
                                            <li class="mdl-menu__item" data-val="Compliance">Compliance</li>
                                            <li class="mdl-menu__item" data-val="Cutting">Cutting</li>
                                            <li class="mdl-menu__item" data-val="Engineering">Engineering</li>
                                            <li class="mdl-menu__item" data-val="Finance">Finance</li>
                                            <li class="mdl-menu__item" data-val="Human Resources">Human Resources</li>
                                            <li class="mdl-menu__item" data-val="Information Technology">Information Technology</li>
                                            <li class="mdl-menu__item" data-val="Logistics">Logistics</li>
                                            <li class="mdl-menu__item" data-val="Maintenance">Maintenance</li>
                                            <li class="mdl-menu__item" data-val="Mechanic">Mechanic</li>
                                            <li class="mdl-menu__item" data-val="Planning">Planning</li>
                                            <li class="mdl-menu__item" data-val="Production">Production</li>
                                            <li class="mdl-menu__item" data-val="Quality">Quality</li>
                                            <li class="mdl-menu__item" data-val="Warehouse">Warehouse</li>
                                        </ul>
                                    </div>
                                    <div>Đánh Giá:</div>
                                    <div id="div_cbb_evaluate" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" 
                                        style="width: 80%; margin-left: 10px;">
                                        <input type="text" value="" class="mdl-textfield__input" id="cbb_evaluate" readonly style="color: black;">
                                        <input type="hidden" value="" name="cbb_evaluate" style="color: black;">
                                        <label for="cbb_evaluate" class="mdl-textfield__label">ĐÁNH GIÁ</label>
                                        <ul for="cbb_evaluate" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-shadow--8dp" id="list_cbb_evaluate" style="color: black;">
                                            <li class="mdl-menu__item" data-val="All">All</li>
                                            <li class="mdl-menu__item" data-val="NOT MEET" style="color: red;">NOT MEET</li>
                                            <li class="mdl-menu__item" data-val="MEET-" style="color: orangered;">MEET-</li>
                                            <li class="mdl-menu__item" data-val="MEET" style="color: black">MEET</li>
                                            <li class="mdl-menu__item" data-val="MEET+" style="color: rgb(122, 204, 0);">MEET+</li>
                                            <li class="mdl-menu__item" data-val="EXCEED" style="color: green;">EXCEED</li>
                                        </ul>
                                    </div>
                                    <div>Nhà Máy:</div>
                                    <div id="div_cbb_plant" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" 
                                        style="width: 80%; margin-left: 10px;">
                                        <input type="text" value="" class="mdl-textfield__input" id="cbb_plant" readonly style="color: black;">
                                        <input type="hidden" value="" name="cbb_plant" style="color: black;">
                                        <label for="cbb_plant" class="mdl-textfield__label">NHÀ MÁY</label>
                                        <ul for="cbb_plant" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-shadow--8dp" id="list_cbb_plant" style="color: black;">
                                            <li class="mdl-menu__item" data-val="All">All</li>
                                            <li class="mdl-menu__item" data-val="Phubai Cutting">Phubai Cutting</li>
                                            <li class="mdl-menu__item" data-val="Phubai Complex">Phubai Complex</li>
                                            <li class="mdl-menu__item" data-val="Phubai AMT">Phubai AMT</li>
                                            <li class="mdl-menu__item" data-val="Phu Bai 3">Phu Bai 3</li>
                                        </ul>
                                    </div>
                                    <div>Nhân Viên:</div>
                                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="margin-left: 10px; width: 80%;">
                                        <input class="mdl-textfield__input" type="number" id="txt_empID" style="color: black;">
                                        <label class="mdl-textfield__label" for="txt_empID">Mã số Nhân Viên...</label>
                                    </div>
                                    <div>Quản Lý:</div>
                                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="margin-left: 10px; width: 80%;">
                                        <input class="mdl-textfield__input" type="number" id="txt_supID" style="color: black;">
                                        <label class="mdl-textfield__label" for="txt_supID">Mã số Quản Lý...</label>
                                    </div>
                                </div>
                                <div class="mdl-card__actions mdl-card--border">
                                    <button class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect " id="btn_search">
                                        <i class="material-icons">search</i>
                                        Search
                                    </button>
                                </div>
                                <!-- <div class="mdl-card__menu">
                                    <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect">
                                        <i class="material-icons">search</i>
                                    </button>
                                </div> -->
                            </div>
                        </div>
                        <div class="mdl-cell mdl-cell--10-col">
                            <div style="width:60%; margin: 10px auto; display: none;" id="kpi_div">
                                <canvas id="kpi_chart"></canvas>
                            </div>
                            <div class="mdl-grid mdl-shadow--6dp" style="padding: 0; margin: 0;">
                                <table class="mdl-data-table mdl-js-data-table" style="border: none; width: 100%;">
                                    <thead style="background-color: green;">
                                        <!-- <col width="25px"> -->
                                        <tr style=" height: 60px;">
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">STT</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">ID</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">TÊN</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">VỊ TRÍ</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">BỘ PHẬN</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">QUẢN LÝ</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">NHÀ MÁY</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">KẾT QUẢ</th>
                                            <th class="mdl-data-table__cell--non-numeric" style="color: white;">ACTION</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table_employee_body">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        <button class="mdl-button mdl-js-button mdl-button--fab 
            mdl-js-ripple-effect mdl-button--colored" style="position: fixed; bottom: 50px; right:40px; z-index: 10; background-color: green;" id="btn_add_period">
            <i class="material-icons">add</i>
        </button>
        <div class="mdl-tooltip" for="btn_add_period" style="z-index: 11;">
            <p style="font-size:12px">Tạo ĐG KPI</p>
        </div>
        <button class="mdl-button mdl-js-button mdl-button--fab 
            mdl-js-ripple-effect mdl-button--colored" style="position: fixed; bottom: 120px; right:40px; z-index: 10; background-color: red;" id="btn_export">
            <i class="material-icons">download</i>
        </button>
        <div class="mdl-tooltip" for="btn_export" style="z-index: 11;">
            <p style="font-size:12px">Tải Excel</p>
        </div>
        <form id="upload_form" method='POST' action='KPI/Upload_KPI_Organize_Chart' submit='return false;'>
            <input type='file' name='file' id='file' style='display: none;'>
            <input type='submit' id='submit' style='display: none;'>
            <button class="mdl-button mdl-js-button mdl-button--fab 
                mdl-js-ripple-effect mdl-button--colored" style="position: fixed; bottom: 190px; right:40px; z-index: 10; background-color: blue;" id="btn_upload">
                <i class="material-icons">upload</i>
            </button>
        </form>
        <div class="mdl-tooltip" for="btn_upload" style="z-index: 11;">
            <p style="font-size:12px">Cập nhật<br>Organize Chart</p>
        </div>
        <button class="mdl-button mdl-js-button mdl-button--fab 
            mdl-js-ripple-effect mdl-button--colored" style="position: fixed; bottom: 260px; right:40px; z-index: 10; background-color: indigo;" id="btn_tempalte">
            <i class="material-icons">insert_drive_file</i>
        </button>
        <div class="mdl-tooltip" for="btn_tempalte" style="z-index: 11;">
            <p style="font-size:12px">Tempate<br>Organize Chart</p>
        </div>
    </body>
    <dialog style="border-radius: 10px; border: none; padding: 0; background-color: transparent;" id="dialog_add_period">
        <div class="demo-card-wide mdl-card mdl-shadow--2dp" style="width: 400px; border-radius: 10px;">
            <div class="mdl-card__title" style="background-color: indigo; color: white; ">
                <h2 class="mdl-card__title-text">TẠO KỲ ĐÁNH GIÁ KPI</h2>
            </div>
            <div class="mdl-card__supporting-text">
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="txt_add_kpi" style="color: black;">
                    <label class="mdl-textfield__label" for="txt_add_kpi">Tên đánh giá</label>
                </div>
                <div id="div_cbb_year_create" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" >
                    <input type="text" value="" class="mdl-textfield__input" id="cbb_year_create" readonly style="color: black;">
                    <input type="hidden" value="" name="cbb_year_create">
                    <label for="cbb_year_create" class="mdl-textfield__label">Năm...</label>
                    <ul for="cbb_year_create" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-shadow--8dp" id="list_cbb_year_create">
                        <li class="mdl-menu__item">2020</li>
                        <li class="mdl-menu__item">2021</li>
                        <li class="mdl-menu__item">2022</li>
                        <li class="mdl-menu__item">2023</li>
                        <li class="mdl-menu__item">2024</li>
                    </ul>
                </div>
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="txt_add_note" style="color: black;">
                    <label class="mdl-textfield__label" for="txt_add_note">Ghi chú thêm</label>
                </div>
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="date" id="txt_add_from" style="color: black;">
                    <label class="mdl-textfield__label" for="txt_add_from">Từ ngày</label>
                </div>
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="date" id="txt_add_to" style="color: black;">
                    <label class="mdl-textfield__label" for="txt_add_to">Đến ngày</label>
                </div>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <button class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" id="btn_add_done">
                    <i class="material-icons">done</i>
                    TẠO MỚI
                </button>
            </div>
            <div class="mdl-card__menu">
                <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" id="btn_add_close" style="background-color: red; color: white;">
                    <i class="material-icons">close</i>
                </button>
            </div>
        </div>
    </dialog>
    <dialog style="border-radius: 10px; border: none; padding: 0; background-color: transparent;" id="dialog_add_period_edit">
        <div class="demo-card-wide mdl-card mdl-shadow--2dp" style="width: 400px; border-radius: 10px;">
            <div class="mdl-card__title" style="background-color: indigo; color: white; ">
                <h2 class="mdl-card__title-text">CẬP NHẬT KỲ ĐÁNH GIÁ KPI</h2>
            </div>
            <div class="mdl-card__supporting-text">
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="txt_add_kpi_edit" style="color: black;" readonly>
                    <label class="mdl-textfield__label" for="txt_add_kpi_edit">Tên đánh giá</label>
                </div>
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="txt_year_create_edit" style="color: black;" readonly>
                    <label class="mdl-textfield__label" for="txt_year_create_edit">Năm đánh giá</label>
                </div>
                <!-- <div id="div_cbb_year_create_edit" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" >
                    <input type="text" value="" class="mdl-textfield__input" id="cbb_year_create_edit" readonly style="color: black;" readonly>
                    <input type="hidden" value="" name="cbb_year_create_edit">
                    <label for="cbb_year_create_edit" class="mdl-textfield__label">Năm...</label>
                    <ul for="cbb_year_create_edit" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-shadow--8dp" id="list_cbb_year_create_edit">
                        <li class="mdl-menu__item" data-val="2020">2020</li>
                        <li class="mdl-menu__item" data-val="2021">2021</li>
                        <li class="mdl-menu__item" data-val="2022">2022</li>
                        <li class="mdl-menu__item" data-val="2023">2023</li>
                        <li class="mdl-menu__item" data-val="2024">2024</li>
                    </ul>
                </div> -->
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="text" id="txt_add_note_edit" style="color: black;">
                    <label class="mdl-textfield__label" for="txt_add_note_edit">Ghi chú thêm</label>
                </div>
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="date" id="txt_add_from_edit" style="color: black;">
                    <label class="mdl-textfield__label" for="txt_add_from_edit">Từ ngày</label>
                </div>
                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" type="date" id="txt_add_to_edit" style="color: black;">
                    <label class="mdl-textfield__label" for="txt_add_to_edit">Đến ngày</label>
                </div>
            </div>
            <div class="mdl-card__actions mdl-card--border">
                <button class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" id="btn_add_done_edit">
                    <i class="material-icons">update</i>
                    CẬP NHẬT
                </button>
            </div>
            <div class="mdl-card__menu">
                <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" id="btn_add_close_edit" style="background-color: red; color: white;">
                    <i class="material-icons">close</i>
                </button>
            </div>
        </div>
    </dialog>
    <dialog style="border: none; border-radius: 10px; width: 210mm; overflow: visible;" class="mdl-dialog" id="dialog_employee_kpi_result">
        <!-- <style>
            @media print {
                dialog { /* Or specify a table class */
                    max-height: 100%;
                    overflow: hidden;
                    page-break-after: always;
                }

            }
        </style> -->
        <div id="dialog_content">
            <div class="mdl-grid">
                <div class="mdl-cell mdl-cell--4-col">
                    <div style="margin:0 auto;">Công ty TNHH Hanesbrands Việt Nam Huế</div>
                    <div style="margin:0 auto;">Hanesbrands Vietnam Hue  </div>
                </div>
                <!-- <div class="mdl-cell mdl-cell--3-col">
                </div> -->
                <div class="mdl-cell mdl-cell--4-col" >
                    <div style="margin:0 auto;">PHU-F-HR-010</div>
                    <div style="margin:0 auto;">Rev. 03 – 30/07/2015</div>
                </div>
            </div>
            <div class="mdl-grid">
                <h5 style="margin: 0 auto;" id="txt_title">BẢNG ĐÁNH GIÁ KẾT QUẢ CÔNG TÁC CUỐI NĂM CÔNG TY HBI</h5>
            </div>
            <div class="mdl-grid">
                <div class="mdl-cell mdl-cell--4-col">
                    <div class="mdl-grid">
                        <div>Họ và tên:</div>
                        <div style="margin-left: 5px; font-weight: bold;" id="txt_name_fill"></div>
                    </div>
                    <div class="mdl-grid">
                        <div>Chức vụ:</div>
                        <div style="margin-left: 5px; font-weight: bold;" id="txt_pos_fill"></div>
                    </div>
                    <div class="mdl-grid">
                        <div>Bộ phận: </div>
                        <div style="margin-left: 5px; font-weight: bold;" id="txt_dept_fill"></div>
                    </div>
                </div>
                <div class="mdl-cell mdl-cell--4-col">
                    <div class="mdl-grid">
                        <div>Mã số nhân viên: </div>
                        <div style="margin-left: 5px; font-weight: bold;" id="txt_id_fill"></div>
                    </div>
                    <div class="mdl-grid">
                        <div>Giai đoạn đánh giá: </div>
                        <div style="margin-left: 5px; font-weight: bold;" id="txt_period_fill"></div>
                    </div>
                    <div class="mdl-grid">
                        <div>Địa điểm làm việc:</div>
                        <div style="margin-left: 5px; font-weight: bold;" id="txt_plant_fill"></div>
                    </div>
                </div>
            </div>
            <hr>
            <h5 class="header-align">NHÂN VIÊN TỰ ĐÁNH GIÁ </h5>
            <h6 class="header-sub-align">Phần 1: Kết quả công việc chủ yếu </h6>
            <p style="font-weight: 10px;">
                Nếu nhân viên tham gia quá trình thiết lập mục tiêu theo quý thì chỉ cần đính kèm bản mục tiêu vào mẫu đánh giá này.
                <br>Nếu không, nhân viên cần điền đủ mục tiêu & kết quả công việc ở phần dưới đây. Nhân viên cần đưa ra ví dụ cụ thể để chứng minh việc mình đã hoàn thành các mục tiêu đề ra như thế nào. 
            </p>
            <div class="mdl-textfield mdl-js-textfield" style="width: 95%;">
                <textarea class="mdl-textfield__input" type="text"  id="txt_tudanhgia" readonly rows="1" style="overflow-y: auto; resize: vertical;"></textarea>
                <!-- <p id="txt_tudanhgia"></p> -->
                <!-- <label class="mdl-textfield__label" for="txt_tudanhgia">Nhân viên tự đánh giá ở đây...</label> -->
            </div>
            <!-- <div id="txt_tudanhgia"></div> -->
            <img style="width: 90%; margin-left: 40px; display: none;" alt="kpi" id="kpi">
            <h5 class="header-align">
                ĐÁNH GIÁ CỦA NGƯỜI QUẢN LÝ
            </h5>
            <h6 class="header-sub-align">
                Phần 3: Góp ý đánh giá kết quả công việc:
            </h6>
            <p class="p-align" style="font-weight: 10px;">
                Người quản lý đánh giá tổng thể kết quả công việc của nhân viên trong năm và cho biết nhân viên đã hoàn thành công việc như thế nào. 
                <br>Người đánh giá cần trung thực khi đánh giá nhằm đảm bảo lợi ích của nhân viên và tính chính xác của việc đánh giá.
            </p>
            <div class="mdl-textfield mdl-js-textfield" style="width: 95%;">
                <textarea class="mdl-textfield__input" type="text"  id="txt_gopy" readonly rows="1" style="overflow-y: auto; resize: vertical;"></textarea>
                <!-- <label class="mdl-textfield__label" for="txt_tudanhgia">Nhân viên tự đánh giá ở đây...</label> -->
            </div>
            <!-- <p id="txt_gopy" class="solid"></p> -->
            
            <h6 class="header-sub-align">
                Phần 4: Các mặt cần tập trung phát triển:
            </h6>
            <p class="p-align" style="font-weight: 10px;">
                Người quản lý  nhận xét, góp ý giúp nhân viên có cơ hội cải thiện trong kỳ đánh giá tiếp theo.
            </p>
            <div class="mdl-textfield mdl-js-textfield" style="width: 95%;">
                <textarea class="mdl-textfield__input" type="text"  id="txt_caithien" readonly rows="1" style="overflow-y: auto; resize: vertical;"></textarea>
                <!-- <label class="mdl-textfield__label" for="txt_tudanhgia">Nhân viên tự đánh giá ở đây...</label> -->
            </div>
            <!-- <p id="txt_caithien" class="solid"></p> -->
            <h6 class="header-sub-align">
                <b>Phần 5: Kết quả đánh giá của Quản lý:</b>
            </h6>
            <div class="mdl-grid" style="padding: 0;">
                <p>Kết quả đánh giá:</p><u><p id="txt_ketqua" style="font-weight: bold; color: red; margin-left: 5px;"></p></u>
            </div>
            <div class="mdl-grid" style="padding: 0;">
                <p>Lý do đánh giá:</p><u><p id="txt_ghichu" style="margin-left: 5px;"></p></u>
            </div>
            <h5 class="header-align">CHỮ KÝ</h5>
            <p class="p-align" style="font-weight: 10px;">
                Ký tên sau khi hoàn tất việc thảo luận đánh giá kết quả công việc giữa hai bên:
            </p>
            <div class="mdl-grid" style="margin-top: 20px;">
                <div class="p-align"> - Nhân viên:</div>
                <div style="margin-left: 280px; margin-top: 10px;">Ngày Date:</div> 
            </div>
            <div class="mdl-grid" style="margin-top: 20px;">
                <div class="p-align">- Người quản lý trực tiếp:</div>
                <div style="margin-left: 200px; margin-top: 10px;">Ngày Date:</div>          
            </div>
            <div class="mdl-grid" style="margin-top: 20px;">
                <div class="p-align">- Nhân sự:</div>
                <div style="margin-left: 280px; margin-top: 10px;">Ngày Date:</div>
            </div>
            <p style="margin-top: 20px;" style="font-weight: 10px;">
                Chữ ký của nhân viên không có nghĩa là nhân viên có đồng ý hay không đồng ý bảng đánh giá kết quả công việc này.
                <br>Chữ ký chỉ chứng tỏ là nhân viên đã đọc bảng đánh giá này và đã trao đổi với với người quản lý của mình.
            </p>
            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" style="float: right; position: fixed; bottom: 50px; right: 40px;" id="btn_close">
                THOÁT
                <i class="material-icons" style="margin-left: 10px;">close</i>
            </button>
            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" style="float: right; position: fixed; bottom: 120px; right: 40px;" id="btn_print">
                IN
                <i class="material-icons" style="margin-left: 10px;">print</i>
            </button>
        </div>
    </dialog>
    
    <script>
        function load_dept(){
            var manager_dept='<%- Dept%>';
            console.log(manager_dept)
            if (manager_dept=='ALL') {
                return;
            } else {
                document.getElementById('btn_update_period').style.display='none'
            }
            dept='';
            switch (manager_dept){
                case 'MEC':
                    dept='Mechanic';
                    break;
                case 'IE':
                    dept='Engineering';
                    break;
                case 'HR':
                    dept='Human Resources';
                    break;
                case 'F&M':
                    dept='Maintenance';
                    break;
                case 'FI':
                    dept='Finance';
                    break;
                case 'CPL':
                    dept='Compliance';
                    break;
                case 'LOG':
                case 'LP':
                    dept='Logistics';
                    break;
                case 'QA':
                    dept='Quality';
                    break;
                case 'PR':
                    dept='Production';
                    break;
                case 'IT':
                    dept='Information Technology';
                    break;
                case 'PL':
                    dept='Planning';
                    break;
                case 'CT':
                case 'IECT':
                    dept='Cutting';
                    break;
            }
            $('ul[for="cbb_dept"] li[data-val="'+dept+'"]').attr('data-selected',true);
            document.getElementById('cbb_dept').disabled =true;            
            getmdlSelect.init('#div_cbb_dept');
        }
        document.getElementById('cbb_year').addEventListener('change', function(){
            load_period();
        })
        plant='Phubai Complex';
        function load_period(){
            year=document.getElementById('cbb_year').value;
            if (year==null || year==''){
                alert('Hãy chọn năm đánh giá!');
                return;
            }
            var xsend= new XMLHttpRequest();
            xsend.open("POST","/HR/Load_KPI_Period",true);
            xsend.onreadystatechange= function(){
                if (this.readyState==4 && this.status==200){
                    data=JSON.parse(xsend.responseText);
                    while (list_cbb_period.childNodes.length>0) list_cbb_period.removeChild(list_cbb_period.childNodes[0]);
                    for (i=0; i<data.length; i++){
                        var li=document.createElement('li');
                        li.setAttribute('class', 'mdl-menu__item');
                        li.setAttribute('data-val', data[i].NAME);
                        li.innerHTML=data[i].NAME;
                        if (data[i].IN_PERIOD=='1') li.setAttribute('style', 'color: green;');
                        else li.setAttribute('style', 'color: red;')
                        list_cbb_period.appendChild(li);
                        sessionStorage.setItem(data[i].NAME+year, JSON.stringify(data[i]))
                    }
                    getmdlSelect.init('#div_cbb_period'); 
                }
            }
            xsend.setRequestHeader("Content-type", "application/json");
            data={year: year}
            xsend.send(JSON.stringify(data));
        }
        document.getElementById('btn_add_done').addEventListener('click', function(){
            var xsend= new XMLHttpRequest();
            xsend.open("POST","/HR/Add_KPI_Period",true);
            xsend.onreadystatechange= function(){
                if (this.readyState==4 && this.status==200){
                    data=xsend.responseText;
                    if (data=='done'){
                        alert('Đã tạo mới chu kì KPI!');
                    }
                }
            }
            xsend.setRequestHeader("Content-type", "application/json");
            period_name=document.getElementById('txt_add_kpi').value;
            period_year=document.getElementById('cbb_year_create').value;
            period_note=document.getElementById('txt_add_note').value;
            period_from=document.getElementById('txt_add_from').value;
            period_to  =document.getElementById('txt_add_to').value;
            data={period_name: period_name, period_year: period_year, period_note: period_note, period_from: period_from, period_to: period_to};
            xsend.send(JSON.stringify(data));
        });
        document.getElementById('btn_search').addEventListener('click', function(){
            var xsend= new XMLHttpRequest();
            var table_employee_body=document.getElementById('table_employee_body');
            xsend.open("POST","/HR/KPI_Report_Detail",true);
            xsend.onreadystatechange= function(){
                if (this.readyState==4 && this.status==200){
                    data=JSON.parse(xsend.responseText);
                    while (table_employee_body.childNodes.length>0)
                        table_employee_body.removeChild(table_employee_body.childNodes[0]);
                    not_meet=0;
                    meet_desc=0;
                    meet=0;
                    meet_plus=0;
                    exceed=0;
                    not_evaluate=0;
                    for (var i=0; i<data.length; i++){
                        tr=document.createElement('tr');
                        //Stt
                        var tdID=document.createElement("td");
                        tdID.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(i+1);
                        tdID.appendChild(node);
                        tr.appendChild(tdID);
                        //ID
                        var tdID=document.createElement("td");
                        tdID.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].EmpID);
                        tdID.appendChild(node);
                        tr.appendChild(tdID);
                        //Name
                        var tdID=document.createElement("td");
                        tdID.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].EmpName);
                        tdID.appendChild(node);
                        tr.appendChild(tdID);
                        //Stt
                        var tdID=document.createElement("td");
                        tdID.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Position);
                        tdID.appendChild(node);
                        tr.appendChild(tdID);
                        //Stt
                        var tdID=document.createElement("td");
                        tdID.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Dept);
                        tdID.appendChild(node);
                        tr.appendChild(tdID);
                        //Stt
                        var tdID=document.createElement("td");
                        tdID.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].SupName);
                        tdID.appendChild(node);
                        tr.appendChild(tdID);
                        //Stt
                        var tdID=document.createElement("td");
                        tdID.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Plant);
                        tdID.appendChild(node);
                        tr.appendChild(tdID);
                        //Stt
                        var tdID=document.createElement("td");
                        tdID.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var node=document.createTextNode(data[i].Evaluate);
                        if (data[i].Evaluate==null) node=document.createTextNode('');
                        tdID.appendChild(node);
                        tr.appendChild(tdID);
                        switch (data[i].Evaluate){
                            case 'NOT MEET':
                                not_meet++;
                                break;
                            case 'MEET-':
                                meet_desc++;
                                break;
                            case 'MEET':
                                meet++;
                                break;
                            case 'MEET+':
                                meet_plus++;
                                break;
                            case 'EXCEED':
                                exceed++;
                                break;
                            default:
                                not_evaluate++;
                        }
                        //btn more
                        var tdMore=document.createElement("td");
                        tdMore.setAttribute("class","mdl-data-table__cell--non-numeric");
                        var div=document.createElement("div");
                        var button=document.createElement("button");
                        button.setAttribute("class", "mdl-button mdl-js-button mdl-button--icon");
                        button.setAttribute("id", "button_more"+i);
                        var icon=document.createElement("i");
                        icon.setAttribute("class", "material-icons");
                        icon.innerHTML="more_vert";
                        componentHandler.upgradeElement(icon);
                        button.appendChild(icon);
                        componentHandler.upgradeElement(button);
                        var ul=document.createElement("ul");
                        ul.setAttribute("class", "mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect");
                        ul.setAttribute("for", "button_more"+i);
                        var li1=document.createElement("li");
                        li1.setAttribute("class", "mdl-menu__item");
                        li1.setAttribute("onclick", "function_detail(this)");
                        li1.innerHTML="<i class='material-icons' style='vertical-align: middle; margin-right:10px; color: green'>insert_comment</i>Chi tiết";
                        componentHandler.upgradeElement(li1);
                        ul.appendChild(li1);
                        tdMore.appendChild(button);
                        tdMore.appendChild(ul);
                        tr.appendChild(tdMore);
                        table_employee_body.appendChild(tr);
                        componentHandler.upgradeDom('MaterialMenu', 'mdl-menu');
                    }
                    labels=['NOT EVALUATE', 'NOT MEET', 'MEET-', 'MEET', 'MEET+', 'EXCEED'];
                    values=new Array();
                    values.push(not_evaluate)
                    values.push(not_meet);
                    values.push(meet_desc);
                    values.push(meet);
                    values.push(meet_plus);
                    values.push(exceed);
                    document.getElementById("kpi_div").innerHTML='<canvas id="kpi_chart"></canvas>';
                    document.getElementById('kpi_div').style.display="grid";
                    console.log(labels, values)
                    draw_graph(labels, values, '', 'kpi_chart', 'doughnut', "KPI", false);
                }
            }
            empID=document.getElementById('txt_empID').value;
            supID=document.getElementById('txt_supID').value;
            dept=document.getElementById('cbb_dept').value;
            if (dept=='All'){
                dept='';
            }
            ex_dept='';
            switch (dept){
                case 'Mechanic':
                ex_dept='MEC';
                    break;
                case 'Engineering':
                ex_dept='IE';
                    break;
                case 'Human Resources':
                ex_dept='HR';
                    break;
                case 'Maintenance':
                ex_dept='F&M';
                    break;
                case 'Finance':
                ex_dept='FI';
                    break;
                case 'Compliance':
                ex_dept='CPL';
                    break;
                case 'Logistics':
                // case 'LP':
                ex_dept="LOG%' or '%LP";
                    break;
                case 'Quality':
                ex_dept='QA';
                    break;
                case 'Production':
                ex_dept='PR';
                    break;
                case 'Information Technology':
                ex_dept='IT';
                    break;
                case 'Planning':
                ex_dept='PL';
                    break;
                case 'Cutting':
                // case 'IECT':
                ex_dept="CT%' or '%IECT";
                    break;
            }
            evaluate=document.getElementById('cbb_evaluate').value;
            if (evaluate=='All'){
                evaluate='';
            }
            plant=document.getElementById('cbb_plant').value;
            if (plant=='All'){
                plant='';
            }
            period=document.getElementById('cbb_period').value;
            if (period=='') {
                alert('Bạn chưa chọn kỳ đánh giá!');
                return;
            }
            ID=period;
            data={ID: ID, empID:empID, supID:supID, dept:ex_dept, evaluate:evaluate, plant: plant};
            console.log(data);
            xsend.setRequestHeader("Content-type", "application/json");
            xsend.send(JSON.stringify(data));
        });
        function imageExists(image_url){
            console.log(image_url);
            var http = new XMLHttpRequest();
            http.open('HEAD', image_url, false);
            http.send();
            return http.status != 404;
        }
        function get_rows(richtext, is_display=0){
            tdg_row=1;
            if (richtext!=null){
                tdg_row=richtext.split('\n').length;
                if (is_display==1) console.log('Start: ', tdg_row)
                for(var i=0; i<richtext.split('\n').length;i++){
                    if (is_display==1) console.log(richtext.split('\n')[i], 'Words length: ', richtext.split('\n')[i].length)
                    if (richtext.split('\n')[i].length>90){
                        tdg_temp=Math.round(richtext.split('\n')[i].length/90-0.5);
                        tdg_row+=tdg_temp;
                        if (is_display==1)
                        console.log(richtext.split('\n')[i].length/90, tdg_temp, tdg_row)
                    }
                }
            }
            return tdg_row
        }
        function function_detail(x){
            ID    =x.parentNode.parentNode.parentNode.parentNode.childNodes[1].innerHTML;
            year  =document.getElementById('cbb_year').value;
            if (year==''|| year==null){
                alert('Bạn chưa chọn Năm đánh giá!');
                return;
            }
            period=document.getElementById('cbb_period').value;
            if (period==''){
                alert('Bạn chưa chọn Kỳ đánh giá!');
                return;
            }
            document.getElementById('txt_title').innerHTML='BẢNG ĐÁNH GIÁ '+period.toUpperCase()+' NĂM '+year
            var xsend= new XMLHttpRequest();
            xsend.open("POST","/Employee/Load_Employee_KPI_Detail",true);
            xsend.onreadystatechange= function(){
                if (this.readyState==4 && this.status==200){
                    data=JSON.parse(xsend.responseText);
                    if (data.length==0){
                        alert('Không tìm thấy thông tin KPI của nhân viên!');
                        return;
                    }
                    document.getElementById('btn_print').style.display="inline";
                    document.getElementById('btn_close').style.display="inline";
                    //append info
                    name  =x.parentNode.parentNode.parentNode.parentNode.childNodes[2].innerHTML;
                    pos   =x.parentNode.parentNode.parentNode.parentNode.childNodes[3].innerHTML;
                    dept  =x.parentNode.parentNode.parentNode.parentNode.childNodes[4].innerHTML;
                    plant =x.parentNode.parentNode.parentNode.parentNode.childNodes[6].innerHTML;
                    document.getElementById('txt_name_fill').innerHTML  =name;
                    document.getElementById('txt_pos_fill').innerHTML   =pos;
                    document.getElementById('txt_dept_fill').innerHTML  =dept;
                    document.getElementById('txt_id_fill').innerHTML    =ID;
                    document.getElementById('txt_period_fill').innerHTML=period;
                    document.getElementById('txt_plant_fill').innerHTML =plant;
                    //display data
                    document.getElementById('txt_tudanhgia').value      =data[0].EmpEvaluate;
                    document.getElementById('txt_tudanhgia').innerHTML  =data[0].EmpEvaluate;//.replace('\n','<br>');
                    document.getElementById('txt_tudanhgia').rows       =get_rows(data[0].EmpEvaluate)
                    document.getElementById('txt_gopy').value           =data[0].SupEvaluate;
                    document.getElementById('txt_gopy').innerHTML       =data[0].SupEvaluate;
                    document.getElementById('txt_gopy').rows            =get_rows(data[0].SupEvaluate);
                    // console.log(get_rows(data[0].SupEvaluate))
                    document.getElementById('txt_caithien').value       =data[0].SupRecommend;
                    document.getElementById('txt_caithien').innerHTML   =data[0].SupRecommend;
                    document.getElementById('txt_caithien').rows        =get_rows(data[0].SupRecommend)
                    document.getElementById('txt_ghichu').innerHTML     =data[0].SupNote;
                    document.getElementById('txt_ketqua').innerHTML     =data[0].Evaluate;
                    //show modal
                    if (imageExists("../Assets/Employee/KPI/"+ID+'_'+period+'.jpg')){
                        document.getElementById('kpi').src="../Assets/Employee/KPI/"+ID+'_'+period+'.jpg';
                        document.getElementById('kpi').style.display="grid";
                    }
                    document.getElementById('dialog_employee_kpi_result').showModal();
                }
            }
            IDCode=ID+'_'+period;
            data={ID: IDCode};
            xsend.setRequestHeader("Content-type", "application/json");
            xsend.send(JSON.stringify(data));
        }
        document.getElementById('btn_print').addEventListener('click', function(){
            // document.getElementById('btn_print').style.display="none";
            // document.getElementById('btn_close').style.display="none";
            // window.print();
            // $('dialog_employee_kpi_result').printThis();
            // print();
            var w=window.open();
            var html="<!DOCTYPE HTML>";
            html += '<html lang="en-us">';
            html += document.getElementById('header_content').innerHTML;//$("#header_content").html()+"<br/><br/>"
            html += "<body>";
            html += document.getElementById('dialog_content').innerHTML;//$("#dialog_content").html();//
            html += "</body>"
            console.log(html)
            w.document.write(html);
            w.window.print();
            w.document.close();
        });
        document.getElementById('btn_close').addEventListener('click', function(){
            document.getElementById('dialog_employee_kpi_result').close();
        });
        document.getElementById('btn_add_period').addEventListener('click', function(){
            var tzoffset = (new Date()).getTimezoneOffset() * 60000; //offset in milliseconds
            var localISOTime = (new Date(Date.now() - tzoffset)).toISOString().slice(0, -1);
            var today= localISOTime.substring(0,10);
            document.getElementById('txt_add_from').value=today;
            document.getElementById('txt_add_from').parentNode.classList.add('is-dirty');
            document.getElementById('txt_add_to').value=today;
            document.getElementById('txt_add_to').parentNode.classList.add('is-dirty');
            document.getElementById('dialog_add_period').showModal();
        });
        document.getElementById('btn_add_close').addEventListener('click', function(){
            document.getElementById('dialog_add_period').close();
            location.reload();
        });
        document.getElementById('btn_export').addEventListener('click', function(){
            var xsend= new XMLHttpRequest();
            xsend.open("POST","/KPI/Export_KPI_File",true);
            xsend.onreadystatechange= function(){
                if (this.readyState==4 && this.status==200){
                    data=xsend.responseText;
                    a=document.createElement('a');
                    a.setAttribute('href', '../Python/HR/KPI/Export/'+data);
                    a.setAttribute('download', data);
                    a.click();
                }
            }
            empID=document.getElementById('txt_empID').value;
            supID=document.getElementById('txt_supID').value;
            dept=document.getElementById('cbb_dept').value;
            if (dept=='All'){
                dept='';
            }
            ex_dept='';
            switch (dept){
                case 'Mechanic':
                ex_dept='MEC';
                    break;
                case 'Engineering':
                ex_dept='IE';
                    break;
                case 'Human Resources':
                ex_dept='HR';
                    break;
                case 'Maintenance':
                ex_dept='F&M';
                    break;
                case 'Finance':
                ex_dept='FI';
                    break;
                case 'Compliance':
                ex_dept='CPL';
                    break;
                case 'Logistics':
                // case 'LP':
                ex_dept="LOG%' or '%LP";
                    break;
                case 'Quality':
                ex_dept='QA';
                    break;
                case 'Production':
                ex_dept='PR';
                    break;
                case 'Information Technology':
                ex_dept='IT';
                    break;
                case 'Planning':
                ex_dept='PL';
                    break;
                case 'Cutting':
                // case 'IECT':
                ex_dept="CT%' or '%IECT";
                    break;
            }
            evaluate=document.getElementById('cbb_evaluate').value;
            if (evaluate=='All'){
                evaluate='';
            }
            plant=document.getElementById('cbb_plant').value;
            if (plant=='All'){
                plant='';
            }
            period=document.getElementById('cbb_period').value;
            if (period=='') {
                alert('Bạn chưa chọn kỳ đánh giá!');
                return;
            }

            ID=period;
            year=document.getElementById('cbb_year').value;
            if (year==''){
                alert('Bạn chưa chọn kỳ đánh giá!');
                return;
            }
            data={ID: ID, empID:empID, supID:supID, dept:ex_dept, evaluate:evaluate, plant: plant, period: period, year: year};
            console.log(data);
            xsend.setRequestHeader("Content-type", "application/json");
            xsend.send(JSON.stringify(data));
        })
        function draw_graph(name, list_data, label, chart_name, typeChar, title="", grid=true){
            var color=new Array();
            for (var i=0; i<name.length; i++){
                color.push('#' + (Math.random().toString(16) + '0000000').slice(2, 8));
            }
            var ctx = document.getElementById(chart_name).getContext('2d');
            var myChart = new Chart(ctx, {
                type: typeChar,//'bar',
                
                data: {
                    labels: name,
                    datasets: [{
                        label: label,//'Sản lượng theo Công đoạn',
                        data: list_data,
                        backgroundColor: color,
                        borderWidth: 1,
                        fill: false
                    }]
                }
                ,options: {
                    animation: {
                        onComplete: function() {
                            var chartInstance = this.chart,
                            ctx = chartInstance.ctx;
            
                            ctx.font = Chart.helpers.fontString(15, Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'center';
            
                            this.data.datasets.forEach(function(dataset, i) {
                                var meta = chartInstance.controller.getDatasetMeta(i);
                                meta.data.forEach(function(bar, index) {
                                    var data = dataset.data[index];
                                    ctx.fillText(data, bar._model.x+25, bar._model.y);
                                });
                            });
                        }
                    },
                    title: {
                        display: true,
                        text: title,
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: false,//true
                                display: false
                            },
                            gridLines:{
                                display: false//grid//true
                            }
                        }],
                        xAxes: [{
                            ticks: {
                                beginAtZero: false,//true
                                display: false
                            },
                            gridLines:{
                                display: false//grid//true
                            }
                        }]
                    }
                }
            });
        }
        document.getElementById('btn_tempalte').addEventListener('click', function(){
            a=document.createElement('a');
            a.setAttribute('href', '/Python/HR/KPI/Template/Employee_Supervisor.xlsx');
            a.click();
        });
        function dateformat(date){
            day=date.split('/')[1]
            if (day.length==1) day='0'+day;
            month=date.split('/')[0]
            if (month.length==1) month='0'+month;
            year=date.split('/')[2];
            return year+'-'+month+'-'+day
        }
        document.getElementById('btn_update_period').addEventListener('click', function(){
            year   =document.getElementById('cbb_year').value;
            if (year==''){
                alert('Bạn chưa chọn Năm của kì đánh giá!');
                return;
            }
            period=document.getElementById('cbb_period').value;
            if (period==''){
                alert('Bạn chưa chọn Kỳ đánh giá!');
                return;
            }
            period_infor=JSON.parse(sessionStorage.getItem(period+year));
            document.getElementById('txt_add_kpi_edit').value=period_infor.NAME;
            document.getElementById('txt_add_kpi_edit').parentNode.classList.add('is-dirty');
            document.getElementById('txt_year_create_edit').value=period_infor.YEAR_PD;
            document.getElementById('txt_year_create_edit').parentNode.classList.add('is-dirty');
            // document.getElementById('cbb_year_create_edit').=;
            // $('ul[for="cbb_year_create_edit"] li[data-val="'+period_infor.YEAR_PD+'"]').attr("data-selected", "true");  
            // getmdlSelect.init('#div_cbb_year_create_edit');
            // document.getElementById('cbb_year_create_edit').parentNode.classList.add('is-dirty');
            document.getElementById('txt_add_note_edit').value=period_infor.NOTE;
            document.getElementById('txt_add_note_edit').parentNode.classList.add('is-dirty');
            var start=dateformat((new Date(period_infor.StartDate)).toLocaleString("en-US", {timeZone: "Asia/Bangkok"}).split(', ')[0]);
            document.getElementById('txt_add_from_edit').value=start;
            document.getElementById('txt_add_from_edit').parentNode.classList.add('is-dirty');
            var expired=dateformat((new Date(period_infor.ExpiredDate)).toLocaleString("en-US", {timeZone: "Asia/Bangkok"}).split(', ')[0]);
            document.getElementById('txt_add_to_edit').value=expired;
            document.getElementById('txt_add_to_edit').parentNode.classList.add('is-dirty');
            
            console.log(period_infor, start, expired)
            document.getElementById('dialog_add_period_edit').showModal();
        });
        document.getElementById('btn_add_close_edit').addEventListener('click', function(){
            document.getElementById('dialog_add_period_edit').close();
        });
        document.getElementById('btn_add_done_edit').addEventListener('click', function(){
            var r = confirm("Bạn có chắc muốn cập lại thông tin?");
            if (r == false) return;
            var xsend= new XMLHttpRequest();
            xsend.open("POST","/HR/Update_KPI_Period",true);
            xsend.onreadystatechange= function(){
                if (this.readyState==4 && this.status==200){
                    data=xsend.responseText;
                    if (data=='done')
                    alert('Cập nhật thành công!');
                }
            }
            period_name=document.getElementById('txt_add_kpi_edit').value;
            period_year=document.getElementById('txt_year_create_edit').value;
            period_ID=JSON.parse(sessionStorage.getItem(period_name+period_year)).ID;
            period_note=document.getElementById('txt_add_note_edit').value;
            period_from=document.getElementById('txt_add_from_edit').value;
            period_to  =document.getElementById('txt_add_to_edit').value;
            xsend.setRequestHeader("Content-type", "application/json");
            data={period_name: period_name, period_year: period_year, period_note: period_note, period_from: period_from, period_to: period_to, IDKey: period_ID}
            xsend.send(JSON.stringify(data));
        });

        var form=document.getElementById('upload_form');
        form.addEventListener('submit', e=>{
            e.preventDefault();
            return false;
        })
        document.getElementById('btn_upload').addEventListener('click', function(){
            document.getElementById('file').click();
            document.getElementById('file').onchange=function(){
                if (document.getElementById('file').value!='') document.getElementById('submit').click();
            }
            var form=document.getElementById('upload_form');
            form.addEventListener('submit', e=>{
                if (document.getElementById('file').value!=''){
                    e.preventDefault();
                    var xsend=new XMLHttpRequest();
                    xsend.onreadystatechange=function(){
                        if (this.readyState==4 && this.status==200){
                            //done
                            result=xsend.responseText;
                            console.log(result);
                            if (result=='done'){
                                alert('File Organize Chart đã được cập nhật!');
                                document.getElementById('file').value='';
                                load_request_PR();
                            } else {
                                alert('Đã có lỗi, hãy kiểm tra lại dòng thứ '+result.split(';')[1]+'!');
                                document.getElementById('file').value='';
                            }
                        }
                    }
                    var fileInput=document.getElementById('file');
                    var file;
                    file=fileInput.files[0];
                    console.log(file['name']);
                    var formData=new FormData();
                    formData.append('file', file);
                    if (file!=null){
                        xsend.open('POST', '/KPI/Upload_KPI_Organize_Chart', true);
                        xsend.send(formData);
                    }
                }
                return false;
            })
        })
    </script>
</html>