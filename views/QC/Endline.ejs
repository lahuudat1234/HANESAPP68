<!DOCTYPE html>
<html lang="en" dir="ltr">
    <header>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <!-- <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-purple.min.css"> -->
        <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.purple-indigo.min.css" />
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
        <link rel="stylesheet" href="/JS/getmdl/getmdl-select.min.css"/>
        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
        <script defer src="/JS/getmdl/getmdl-select.min.js"></script>
        <script defer type="text/javascript" src="/JS/chart/Chart.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </header>
    <body>
        <!-- Always shows a header, even in smaller screens. -->
        <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
            <header class="mdl-layout__header">
                <div class="mdl-layout__header-row">
                    <span class="mdl-layout-title">ENDLINE</span>
                    <%- include ("partials/headerTemplate.ejs"); -%>
                </div>
            </header>
            <%- include ("partials/navTemplate.ejs"); -%>
            <main class="mdl-layout__content">
                <div class="page-content">
                    <div style="width: 95%; margin: 10px auto; border-radius: 10px;">
                        <div class="mdl-grid mdl-shadow--2dp" style="background: white; border-radius: 10px;">
                            <div style="margin: 10px auto;">
                                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label has-placeholder" style="width:150px; margin-right: 50px;">
                                    <input class="mdl-textfield__input" type="date" id="date_group_search">
                                    <label class="mdl-textfield__label" for="date_group_search">Chọn ngày</label>
                                </div>
                                <!-- <div id="cbb_group" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" 
                                        style="width: 100px; margin-right: 50px;">
                                    <input type="text" value="" class="mdl-textfield__input" id="txt_group" readonly>
                                    <input type="hidden" value="" name="groupScan">
                                    <label for="groupScan" class="mdl-textfield__label">Chuyền</label>
                                    <ul for="groupScan" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-shadow--8dp" id="groupScanList">
                                        <li class="mdl-menu__item" data-selected="true">001-007</li>
                                        <li class="mdl-menu__item">010-017</li>
                                        <li class="mdl-menu__item">020-024</li>
                                        <li class="mdl-menu__item">035-042</li>
                                        <li class="mdl-menu__item">043-050</li>
                                        <li class="mdl-menu__item">051-059</li>
                                        <li class="mdl-menu__item">060-066</li>
                                        <li class="mdl-menu__item">067-074</li>
                                        <li class="mdl-menu__item">075-082</li>
                                        <li class="mdl-menu__item">083-090</li>
                                        <li class="mdl-menu__item">091-098</li>
                                        <li class="mdl-menu__item">106-111</li>
                                        <li class="mdl-menu__item">112-118</li>
                                        <li class="mdl-menu__item">204-210</li>
                                        <li class="mdl-menu__item">211-217</li>
                                        <li class="mdl-menu__item">218-224</li>
                                        <li class="mdl-menu__item">225-231</li>
                                        <li class="mdl-menu__item">239-245</li>
                                        <li class="mdl-menu__item">253-259</li>
                                        <li class="mdl-menu__item">260-266</li>
                                        <li class="mdl-menu__item">277-283</li>
                                        <li class="mdl-menu__item">291-297</li>
                                        <li class="mdl-menu__item">298-304</li>
                                        <li class="mdl-menu__item">305-311</li>
                                        <li class="mdl-menu__item">312-318</li>
                                        <li class="mdl-menu__item">319-325</li>
                                        <li class="mdl-menu__item">326-332</li>
                                        <li class="mdl-menu__item">333-339</li>
                                        <li class="mdl-menu__item">346-353</li>
                                    </ul>
                                </div> -->
                                <div id="cbb_shift" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" 
                                        style="width: 100px; margin-right: 50px;">
                                    <input type="text" value="" class="mdl-textfield__input" id="txt_shift" readonly>
                                    <input type="hidden" value="" name="shiftScan">
                                    <label for="shiftScan" class="mdl-textfield__label">Ca</label>
                                    <ul for="shiftScan" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-shadow--8dp" id="shiftScanList">
                                        <li class="mdl-menu__item" data-selected="true">RIT</li>
                                        <li class="mdl-menu__item">BALI</li>
                                    </ul>
                                </div>
                                <button class="mdl-button mdl-js-button mdl-button--fab 
                                        mdl-js-ripple-effect mdl-button--colored" id="btn_group_search">
                                    <i class="material-icons">search</i>
                                </button>
                            </div>
                            <div style="width: 100%;">
                                <div id="table_group_spinner" style="margin-left: 50%;"></div>
                            </div>
                            <div style="width: 90%; margin: 0px auto;">
                                <ul style="margin:0px 0px;">
                                    <li class="mdl-list__item">
                                        <span class="mdl-list__item-primary-content" style="width: 50%; text-align: right; float:left;">
                                            <i class="material-icons mdl-list__item-icon" style="color: green;">face</i>
                                                <div id="txt_image_scanned">Tổng mẫu: 0</div>
                                        </span>
                                        <span class="mdl-list__item-primary-content" style="width: 50%; text-align: left; float:left;">
                                            <i class="material-icons mdl-list__item-icon" style="color: red;">error</i>
                                                <div id="txt_image_error_scan">Tổng lỗi: 0</div>
                                        </span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="mdl-grid" style="width: 95%; margin: 0px auto;">
                        <div class="mdl-cell mdl-cell--6-col">
                            <div class="mdl-card mdl-shadow--2dp" style="width:100%; border-radius: 10px; height: 100%">
                                <div class="mdl-card__title" style="color: white; background: green;">
                                    <h2 class="mdl-card__title-text">Endline theo Nhà máy</h2>
                                </div>
                                <div class="mdl-card__supporting-text" style="margin:0px auto;">
                                    <div style="margin: 0px auto; overflow-x:auto">
                                        <table class="mdl-data-table mdl-js-data-table" style="width: 95%; margin:0px auto;">
                                            <col width="21px">
                                            <thead>
                                                <tr>
                                                    <th class="mdl-data-table__cell--non-numeric">GroupLine</th>
                                                    <th class="mdl-data-table__cell--non-numeric">Mục tiêu (%)</th>
                                                    <th class="mdl-data-table__cell--non-numeric">Thực tế (%) </th>
                                                    <th class="mdl-data-table__cell--non-numeric">Kết quả (%)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="mdl-data-table__cell--non-numeric">Nhà máy 1</td>
                                                    <td class="mdl-data-table__cell--non-numeric" id="txt_plant1_target">1.40</td>
                                                    <td class="mdl-data-table__cell--non-numeric" id="txt_plant1_actual">0</td>
                                                    <td class="mdl-data-table__cell--non-numeric" id="txt_plant1_result">-1.40</td>
                                                </tr>
                                                <tr>
                                                    <td class="mdl-data-table__cell--non-numeric">Nhà máy 2</td>
                                                    <td class="mdl-data-table__cell--non-numeric" id="txt_plant2_target">1.40</td>
                                                    <td class="mdl-data-table__cell--non-numeric" id="txt_plant2_actual">0</td>
                                                    <td class="mdl-data-table__cell--non-numeric" id="txt_plant2_result">-1.40</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div style="background-color: white; display: none;" id="plant1_chart_div">
                                        <canvas id="plant1_chart"></canvas>
                                    </div>
                                    <div style="background-color: white; display: none;" id="plant2_chart_div">
                                        <canvas id="plant2_chart"></canvas>
                                    </div>
                                </div>
                                <div class="mdl-card__actions mdl-card--border">
                                    <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" id="btn_plant_detail">
                                        <div id="btn_plant_detail_div">Chi tiết</div>
                                    </a>
                                </div>
                                <div class="mdl-card__menu">
                                    <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" style="color: white;">
                                        <i class="material-icons">save</i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="mdl-cell mdl-cell--6-col">
                            <div class="mdl-card mdl-shadow--2dp" style="width: 100%; border-radius: 10px; height: fit-content;">
                                <div class="mdl-card__title" style="color: white; background: orange;">
                                    <h2 class="mdl-card__title-text">Endline theo Group</h2>
                                </div>
                                
                                <div class="mdl-card__actions mdl-card--border">
                                    <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" >
                                        Chi tiết
                                    </a>
                                </div>
                                <div class="mdl-card__menu">
                                    <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" style="color: white;">
                                        <i class="material-icons">save</i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mdl-grid" style="width: 95%; margin: 10px auto;">
                        <div class="mdl-cell mdl-cell--6-col">
                            <div class="mdl-card mdl-shadow--2dp" style="width:100%; border-radius: 10px;">
                                <div class="mdl-card__title" style="color: white; background: purple;">
                                    <h2 class="mdl-card__title-text">Endline Facemask</h2>
                                </div>
                                <div class="mdl-card__supporting-text" style="margin:0px auto;">
                                    <div style="margin: 0px auto; overflow-x:auto">
                                        <table class="mdl-data-table mdl-js-data-table" style="margin:0px auto; width: 95%;">
                                            <thead>
                                                <tr>
                                                    <th class="mdl-data-table__cell--non-numeric">Mã lỗi</th>
                                                    <th class="mdl-data-table__cell--non-numeric">Tên lỗi</th>
                                                    <th class="mdl-data-table__cell--non-numeric">Nguồn gốc</th>
                                                    <th class="mdl-data-table__cell--non-numeric">Tỉ lệ</th>
                                                </tr>
                                            </thead>
                                            <tbody id="table_body_facemask_summary">
                                            </tbody>
                                        </table>
                                    </div>
                                    <div style="background-color: white; display: none;" id="facemask_chart_div">
                                        <canvas id="facemask_chart"></canvas>
                                    </div>
                                </div>
                                <div class="mdl-card__actions mdl-card--border">
                                    <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" id="btn_facemask_detail">
                                        <div id="btn_facemask_detail_div">Chi tiết</div>
                                    </a>
                                </div>
                                <div class="mdl-card__menu">
                                    <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" style="color: white;">
                                        <i class="material-icons">save</i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="mdl-cell mdl-cell--6-col">
                            <div class="mdl-card mdl-shadow--2dp" style="width: 100%; border-radius: 10px;">
                                <div class="mdl-card__title" style="color: white; background: blue;">
                                    <h2 class="mdl-card__title-text">Endline MUW</h2>
                                </div>
                                <div class="mdl-card__supporting-text" style="margin:0px auto;">
                                    <div style="margin: 0px auto; overflow-x:auto">
                                        <table class="mdl-data-table mdl-js-data-table" style="margin:0px auto; width: 95%;">
                                            <thead>
                                                <tr>
                                                    <th class="mdl-data-table__cell--non-numeric">Mã lỗi</th>
                                                    <th class="mdl-data-table__cell--non-numeric">Tên lỗi</th>
                                                    <th class="mdl-data-table__cell--non-numeric">Nguồn gốc</th>
                                                    <th class="mdl-data-table__cell--non-numeric">Tỉ lệ</th>
                                                </tr>
                                            </thead>
                                            <tbody id="table_body_muw_summary">
                                            </tbody>
                                        </table>
                                    </div>
                                    <div style="background-color: white; display: none;" id="muw_chart_div">
                                        <canvas id="muw_chart"></canvas>
                                    </div>
                                </div>
                                <div class="mdl-card__actions mdl-card--border">
                                    <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" id="btn_muw_detail">
                                        <div id="btn_muw_detail_div">Chi tiết</div>
                                    </a>
                                </div>
                                <div class="mdl-card__menu">
                                    <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect" style="color: white;">
                                        <i class="material-icons">save</i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </body>
</html>

<script>
    var today=new Date();
    var table_group_search=document.getElementById('table_group_search');
    document.getElementById('date_group_search').value=today.toISOString().substr(0,10);
    document.getElementById('btn_group_search').addEventListener('click', function(){
        // var group_data=document.getElementById('txt_group').value;
        var shift=document.getElementById('txt_shift').value;
        var full_date=document.getElementById('date_group_search').value;
        year=full_date.substr(0,4);
        month=full_date.substr(5,2);
        day=full_date.substr(8,2);
        var date=year+month+day;
        PlantSummary(date);
        FaceMaskSummary(date);
        MUWSummary(date);
    });

    function GroupSummary(group, date){
        // xsend.open("POST","/QC/Endline/GroupSummary",true);
        // xsend.onreadystatechange= function(){
        //     if (this.readyState==4 && this.status==200){
        //         data=JSON.parse(xsend.responseText);
        //         if (data=='empty') 
        //             alert('Không tìm thấy dữ liệu!');
        //         else {
        //             table_group_load_spinner.removeAttribute("class");
        //             table_group_search.style.display="grid";
        //         }
        //         for (var i=0; i<data.length; i++){
                    
        //         }
        //     }
        // }
        // xsend.setRequestHeader("Content-type", "application/json");
        // data={group: group, date: date};
        // xsend.send(JSON.stringify(data));
    }

    
    var btn_plant_detail=document.getElementById("btn_plant_detail");
    btn_plant_detail.addEventListener('click', function(){
        if (document.getElementById("btn_plant_detail_div").innerHTML=="CHI TIẾT"){
            document.getElementById("plant1_chart_div").style.display="grid";
            document.getElementById("plant2_chart_div").style.display="grid";
            document.getElementById("btn_plant_detail_div").innerHTML="THU NHỎ";
        } else {
            document.getElementById("plant1_chart_div").style.display="none";
            document.getElementById("plant2_chart_div").style.display="none";
            document.getElementById("btn_plant_detail_div").innerHTML="CHI TIẾT";
        }
        
    });
    var btn_facemask_detail=document.getElementById("btn_facemask_detail");
    btn_facemask_detail.addEventListener('click', function(){
        if (document.getElementById("btn_facemask_detail_div").innerHTML=="CHI TIẾT"){
            document.getElementById("facemask_chart_div").style.display="grid";
            document.getElementById("btn_facemask_detail_div").innerHTML="THU NHỎ";
        } else {
            document.getElementById("facemask_chart_div").style.display="none";
            document.getElementById("btn_facemask_detail_div").innerHTML="CHI TIẾT";
        }
        
    });
    var btn_muw_detail=document.getElementById("btn_muw_detail");
    btn_muw_detail.addEventListener('click', function(){
        if (document.getElementById("btn_muw_detail_div").innerHTML=="CHI TIẾT"){
            document.getElementById("muw_chart_div").style.display="grid";
            document.getElementById("btn_muw_detail_div").innerHTML="THU NHỎ";
        } else {
            document.getElementById("muw_chart_div").style.display="grid";
            document.getElementById("btn_muw_detail_div").innerHTML="CHI TIẾT";
        }
    });
    var irr_name1= new Array();
    var irr_name2= new Array();
    var irr_list1= new Array();
    var irr_list2= new Array();
    function PlantSummary(date){
        var xsend= new XMLHttpRequest();
        xsend.open("POST","/QC/Endline/PlantSummary",true);
        xsend.onreadystatechange= function(){
            if (this.readyState==4 && this.status==200){
                data=JSON.parse(xsend.responseText);
                if (data=='empty') 
                    alert('Không tìm thấy dữ liệu!');
                else {
                    sumOfIRR_plant1=0;
                    sumOfIRR_plant2=0;
                    sumOfSample_plant1=0;
                    sumOfSample_plant2=0;
                    for (var i=0; i<data.length; i++){
                        if (data[i].PLANT==1){
                            sumOfSample_plant1=sumOfSample_plant1+data[i].BUNDLE_COUNT;
                            if (data[i].IRR!='000' && !data[i].IRR_NAME!==null) {
                                sumOfIRR_plant1=sumOfIRR_plant1+data[i].IRR_COUNT;
                                irr_name1.push(data[i].IRR_NAME);
                                irr_list1.push(data[i].IRR_COUNT);
                            }
                        } else {
                            sumOfSample_plant2=sumOfSample_plant2+data[i].BUNDLE_COUNT;
                            if (data[i].IRR!='000' && data[i].IRR_NAME!==null) {
                                sumOfIRR_plant2=sumOfIRR_plant2+data[i].IRR_COUNT;
                                irr_name2.push(data[i].IRR_NAME);
                                irr_list2.push(data[i].IRR_COUNT);
                            }
                        }
                    }
                    document.getElementById("txt_image_scanned").innerHTML=(sumOfSample_plant1+sumOfSample_plant2)*3;
                    document.getElementById("txt_image_error_scan").innerHTML=sumOfIRR_plant1+sumOfIRR_plant2;
                    document.getElementById("txt_plant1_actual").innerHTML=(Math.round(sumOfIRR_plant1/(sumOfSample_plant1*3)*10000)/100).toString();
                    document.getElementById("txt_plant1_result").innerHTML=(Math.round((document.getElementById("txt_plant1_target").innerHTML-document.getElementById("txt_plant1_actual").innerHTML)*100)/100).toString();
                    document.getElementById("txt_plant2_actual").innerHTML=(Math.round(sumOfIRR_plant2/(sumOfSample_plant2*3)*10000)/100).toString();
                    document.getElementById("txt_plant2_result").innerHTML=(Math.round((document.getElementById("txt_plant2_target").innerHTML-document.getElementById("txt_plant2_actual").innerHTML)*100)/100).toString();
                    document.getElementById("plant1_chart").remove();
                    document.getElementById("plant1_chart_div").innerHTML='<canvas id="plant1_chart"></canvas>';
                    document.getElementById("plant2_chart").remove();
                    document.getElementById("plant2_chart_div").innerHTML='<canvas id="plant2_chart"></canvas>';
                    draw_graph(irr_name1, irr_list1, 'Nha may 1', 'plant1_chart', 'bar');
                    draw_graph(irr_name2, irr_list2, 'Nha may 2', 'plant2_chart', 'bar');
                }
            }
        }
        xsend.setRequestHeader("Content-type", "application/json");
        data={date: date};
        xsend.send(JSON.stringify(data));
    }

    var irr_facemask_name= new Array();
    var irr_facemask_list= new Array();
    function FaceMaskSummary(date){
        var xsend= new XMLHttpRequest();
        xsend.open("POST","/QC/Endline/FacemaskSummary",true);
        xsend.onreadystatechange= function(){
            if (this.readyState==4 && this.status==200){
                data=JSON.parse(xsend.responseText);
                if (data=='empty') 
                    alert('Không tìm thấy dữ liệu!');
                else {
                    data=data.sort((a,b)=> b.IRR_COUNT-a.IRR_COUNT);
                    sumIRR=0;
                    for (var i=0; i<data.length; i++){
                        sumIRR=sumIRR+data[i].IRR_COUNT;
                    }
                    for (var i=0; i<data.length; i++){
                        if (data[i].IRR!='000' && data[i].IRR_NAME!==null) {
                            irr_facemask_name.push(data[i].IRR_NAME);
                            irr_facemask_list.push(data[i].IRR_COUNT);
                        }
                        if (data[i].IRR!='000' && data[i].IRR_NAME!==null && i<6){
                            var tr=document.createElement("tr");
                            //Ma loi
                            var tdCode=document.createElement("td");
                            tdCode.setAttribute("class","mdl-data-table__cell--non-numeric");
                            var node=document.createTextNode(data[i].IRR);
                            tdCode.appendChild(node);
                            tr.appendChild(tdCode);
                            //Ten Loi
                            var tdName=document.createElement("td");
                            tdName.setAttribute("class","mdl-data-table__cell--non-numeric");
                            var node=document.createTextNode(data[i].IRR_NAME);
                            tdName.appendChild(node);
                            tr.appendChild(tdName);
                            //Nguon goc
                            var tdSource=document.createElement("td");
                            tdSource.setAttribute("class","mdl-data-table__cell--non-numeric");
                            var node=document.createTextNode(data[i].SOURCE);
                            tdSource.appendChild(node);
                            tr.appendChild(tdSource);
                            //Ti le
                            var tdRate=document.createElement("td");
                            tdRate.setAttribute("class","mdl-data-table__cell--non-numeric");
                            var node=document.createTextNode(Math.round(data[i].IRR_COUNT/sumIRR*10000)/100+'%');
                            tdRate.appendChild(node);
                            tr.appendChild(tdRate);
                            componentHandler.upgradeElement(tr);
                            document.getElementById("table_body_facemask_summary").appendChild(tr);
                        }
                    }
                    console.log(irr_facemask_name);
                    console.log(irr_facemask_list);
                    draw_graph(irr_facemask_name, irr_facemask_list, 'Face Mask', 'facemask_chart', 'pie');
                }
            }
        }
        xsend.setRequestHeader("Content-type", "application/json");
        data={date: date};
        xsend.send(JSON.stringify(data));
    }

    var irr_muw_name= new Array();
    var irr_muw_list= new Array();
    function MUWSummary(date){
        var xsend= new XMLHttpRequest();
        xsend.open("POST","/QC/Endline/MUWSummary",true);
        xsend.onreadystatechange= function(){
            if (this.readyState==4 && this.status==200){
                data=JSON.parse(xsend.responseText);
                if (data=='empty') 
                    alert('Không tìm thấy dữ liệu!');
                else {
                    data=data.sort((a,b)=> b.IRR_COUNT-a.IRR_COUNT);
                    sumIRR=0;
                    for (var i=0; i<data.length; i++){
                        sumIRR=sumIRR+data[i].IRR_COUNT;
                    }
                    for (var i=0; i<data.length; i++){
                        if (data[i].IRR!='000' && data[i].IRR_NAME!==null) {
                            irr_muw_name.push(data[i].IRR_NAME);
                            irr_muw_list.push(data[i].IRR_COUNT);
                        }
                        if (data[i].IRR!='000' && data[i].IRR_NAME!==null && i<6){
                            var tr=document.createElement("tr");
                            //Ma loi
                            var tdCode=document.createElement("td");
                            tdCode.setAttribute("class","mdl-data-table__cell--non-numeric");
                            var node=document.createTextNode(data[i].IRR);
                            tdCode.appendChild(node);
                            tr.appendChild(tdCode);
                            //Ten Loi
                            var tdName=document.createElement("td");
                            tdName.setAttribute("class","mdl-data-table__cell--non-numeric");
                            var node=document.createTextNode(data[i].IRR_NAME);
                            tdName.appendChild(node);
                            tr.appendChild(tdName);
                            //Nguon goc
                            var tdSource=document.createElement("td");
                            tdSource.setAttribute("class","mdl-data-table__cell--non-numeric");
                            var node=document.createTextNode(data[i].SOURCE);
                            tdSource.appendChild(node);
                            tr.appendChild(tdSource);
                            //Ti le
                            var tdRate=document.createElement("td");
                            tdRate.setAttribute("class","mdl-data-table__cell--non-numeric");
                            var node=document.createTextNode(Math.round(data[i].IRR_COUNT/sumIRR*10000)/100+'%');
                            tdRate.appendChild(node);
                            tr.appendChild(tdRate);
                            componentHandler.upgradeElement(tr);
                            document.getElementById("table_body_muw_summary").appendChild(tr);
                        }
                    }
                    console.log(irr_muw_name);
                    console.log(irr_muw_list);
                    draw_graph(irr_muw_name, irr_muw_list, 'MUW', 'muw_chart', 'pie');
                }
            }
        }
        xsend.setRequestHeader("Content-type", "application/json");
        data={date: date};
        xsend.send(JSON.stringify(data));
    }

    function draw_graph(name, list_data, label, chart_name, typeChar){
        var color=new Array();
        for (var i=0; i<name.length; i++){
            color.push('#' + (Math.random().toString(16) + '0000000').slice(2, 8));
        }
        var ctx = document.getElementById(chart_name).getContext('2d');
        var myChart = new Chart(ctx, {
            type: typeChar,//'bar',
            data: {
                labels: name,
                datasets: [{
                    label: label,//'Sản lượng theo Công đoạn',
                    data: list_data,
                    backgroundColor: color,
                    borderWidth: 1,
                    fill: false
                }]
            }
            ,options: {
                // plugins:{
                //     colorschemes:{
                //         scheme: 'tableau.Classic10'
                //     }
                // },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        },
                        gridLines:{
                            display: false
                        }
                    }]
                }
            }
        });
    }
</script>