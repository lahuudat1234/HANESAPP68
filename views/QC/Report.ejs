<!DOCTYPE html>
<html lang="en" dir="ltr">
    <header>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <!-- <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-purple.min.css"> -->
        <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.purple-indigo.min.css" />
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
        <link rel="stylesheet" href="/JS/getmdl/getmdl-select.min.css"/>
        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
        <script defer src="/JS/getmdl/getmdl-select.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Báo Cáo</title>
    </header>
    <body>
        <!-- Always shows a header, even in smaller screens. -->
        <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
            <header class="mdl-layout__header">
                <div class="mdl-layout__header-row">
                    <span class="mdl-layout-title">Xuất báo cáo</span>
                    <%- include ("partials/headerTemplate.ejs"); -%>
                </div>
            </header>
            <%- include ("partials/navTemplate.ejs"); -%>
            <main class="mdl-layout__content">
                <div class="page-content">
                    <div style="width: 95%; margin: 10px auto; border-radius: 10px;">
                        <div class="mdl-grid mdl-shadow--2dp" style="background: white; border-radius: 10px;">
                            <div style="margin: 10px auto;">
                                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label has-placeholder" style="width:220px; margin-right: 50px;">
                                    <input class="mdl-textfield__input" type="datetime-local" id="txt_from_date">
                                    <label class="mdl-textfield__label" for="txt_from_date">Chọn thời gian</label>
                                </div>
                                <!-- <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label has-placeholder" style="width:220px; margin-right: 50px;">
                                    <input class="mdl-textfield__input" type="datetime-local" id="txt_to_date">
                                    <label class="mdl-textfield__label" for="txt_to_date">Đến ngày</label>
                                </div> -->
                                <!-- <div id="cbb_group_div" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" 
                                        style="width: 100px; margin-right: 50px;">
                                    <input type="text" value="" class="mdl-textfield__input" id="cbb_group" readonly>
                                    <input type="hidden" value="" name="cbb_group">
                                    <label for="cbb_group" class="mdl-textfield__label">Chuyền</label>
                                    <ul for="cbb_group" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-shadow--8dp" id="cbb_group_list">
                                        <li class="mdl-menu__item" data-selected="true">Tất cả</li>
                                        <li class="mdl-menu__item">6h</li>
                                        <li class="mdl-menu__item">010-017</li>
                                        <li class="mdl-menu__item">020-024</li>
                                        <li class="mdl-menu__item">035-042</li>
                                        <li class="mdl-menu__item">043-050</li>
                                        <li class="mdl-menu__item">051-059</li>
                                        <li class="mdl-menu__item">060-066</li>
                                        <li class="mdl-menu__item">067-074</li>
                                        <li class="mdl-menu__item">075-082</li>
                                        <li class="mdl-menu__item">083-090</li>
                                        <li class="mdl-menu__item">091-098</li>
                                        <li class="mdl-menu__item">106-111</li>
                                        <li class="mdl-menu__item">112-118</li>
                                        <li class="mdl-menu__item">204-210</li>
                                        <li class="mdl-menu__item">211-217</li>
                                        <li class="mdl-menu__item">218-224</li>
                                        <li class="mdl-menu__item">225-231</li>
                                        <li class="mdl-menu__item">239-245</li>
                                        <li class="mdl-menu__item">253-259</li>
                                        <li class="mdl-menu__item">260-266</li>
                                        <li class="mdl-menu__item">277-283</li>
                                        <li class="mdl-menu__item">291-297</li>
                                        <li class="mdl-menu__item">298-304</li>
                                        <li class="mdl-menu__item">305-311</li>
                                        <li class="mdl-menu__item">312-318</li>
                                        <li class="mdl-menu__item">319-325</li>
                                        <li class="mdl-menu__item">326-332</li>
                                        <li class="mdl-menu__item">333-339</li>
                                        <li class="mdl-menu__item">346-353</li>
                                    </ul>
                                </div> -->
                                <div id="cbb_shift_div" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" 
                                        style="width: 100px; margin-right: 50px;">
                                    <input type="text" value="" class="mdl-textfield__input" id="cbb_shift" readonly>
                                    <input type="hidden" value="" name="cbb_shift">
                                    <label for="cbb_shift" class="mdl-textfield__label">Khung giờ</label>
                                    <ul for="cbb_shift" class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-shadow--8dp" id="cbb_shift_list">
                                        <li class="mdl-menu__item" data-selected="true">2h</li>
                                        <li class="mdl-menu__item">1h</li>
                                    </ul>
                                </div>
                                <button class="mdl-button mdl-js-button mdl-button--fab 
                                        mdl-js-ripple-effect mdl-button--colored" id="btn_download">
                                    <i class="material-icons">cloud_download</i>
                                </button>
                            </div>
                            <div style="width: 100%;">
                                <div id="spinner_wait_file" style="margin-left: 50%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </body>
    <script>
        var tzoffset = (new Date()).getTimezoneOffset() * 60000; //offset in milliseconds
        var localISOTime = (new Date(Date.now() - tzoffset)).toISOString().slice(0, -1);
        var today= localISOTime;
        console.log(today.substr(0,13)+'00:00');
        document.getElementById('txt_from_date').value=today.substr(0,13)+':00:00';//.substr(0,10);
        document.getElementById('btn_download').addEventListener('click', function(){
            var full_date_from = document.getElementById('txt_from_date').value;
            year          = full_date_from.substr(0,4);
            month         = full_date_from.substr(5,2);
            day           = full_date_from.substr(8,2);
            hour          = full_date_from.substr(11,2);
            var datefrom  = year+'-'+month+'-'+day+' '+hour+':00:00';
            var spinner_wait_file=document.getElementById('spinner_wait_file');
            spinner_wait_file.setAttribute("class","mdl-spinner mdl-js-spinner is-active");
            componentHandler.upgradeElement(spinner_wait_file);
            var xsend1= new XMLHttpRequest();
            xsend1.open("POST","/QC/Report/Endline",true);
            xsend1.onreadystatechange= function(){
                if (this.readyState==4 && this.status==200) {
                    spinner_wait_file.removeAttribute("class");
                    data=xsend1.responseText;
                    console.log(data);
                    if (data=='fail'){
                        alert('Khung giờ không nằm trong Scan!');
                        return;
                    } else {
                        alert('Đã tạo file: '+ xsend1.responseText)
                    }
                    // var a=document.createElement('a');
                    // a.href="../Python/QC/Endline/Report/"+data;
                    // a.download=data;
                    // a.click();
                }
            }
            xsend1.setRequestHeader("Content-type", "application/json");
            var shift=document.getElementById('cbb_shift').value;
            data={datefrom: datefrom, shift: shift};
            console.log(data);
            
            xsend1.send(JSON.stringify(data));
        });
    </script>
</html>